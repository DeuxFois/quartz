<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Visiteur vous permet de séparer les algorithmes et les objets sur lesquels ils opèrent.
 Problème Imaginez que votre équipe développe une application avec des informations géographiques qui prennent la forme d’un graphe géant."><title>Visiteur / Visitor</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://deuxfois.github.io/quartz//icon.png><link href=https://deuxfois.github.io/quartz/styles.b54f56dc7e7fdf6be9a4427dc6b0509b.min.css rel=stylesheet><link href=https://deuxfois.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://deuxfois.github.io/quartz/js/darkmode.69b2c08ae0f08c3a3f86259a122e1f06.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/util.39f53d45cb9520bdaf946bd063598b19.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://deuxfois.github.io/quartz/js/popover.37b1455b8f0603154072b9467132c659.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://deuxfois.github.io/quartz/",fetchData=Promise.all([fetch("https://deuxfois.github.io/quartz/indices/linkIndex.ae532b25b7234418be730011680aea32.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://deuxfois.github.io/quartz/indices/contentIndex.45208b3232516fb903f7135102456dc8.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://deuxfois.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://deuxfois.github.io/quartz",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/deuxfois.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://deuxfois.github.io/quartz/js/full-text-search.0ec5fb908204b9e13989f2c640c0870b.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://deuxfois.github.io/quartz/>⛄ DeuxFoi's blog</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Visiteur / Visitor</h1><p class=meta>Last updated
Aug 2, 2022
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/Architecture/Design_Pattern/Behavioral/Visiteur.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://deuxfois.github.io/quartz/tags/behavioral/>Behavioral</a></li><li><a href=https://deuxfois.github.io/quartz/tags/design_pattern/>Design pattern</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#problème>Problème</a></li><li><a href=#solution>Solution</a></li><li><a href=#analogie>Analogie</a></li><li><a href=#structure>Structure</a></li><li><a href=#pseudo-code>Pseudo-code</a></li><li><a href=#possibilités-dapplication>Possibilités d’application</a></li><li><a href=#mise-en-œuvre>Mise en œuvre</a></li><li><a href=#avantages-et-inconvénients>Avantages et inconvénients</a></li><li><a href=#liens-avec-les-autres-patrons>Liens avec les autres patrons</a></li><li><a href=#exemples-de-code>Exemples de code</a></li><li><a href=#informations-supplémentaires>Informations supplémentaires</a><ol><li><a href=#soutenez-notre-site-gratuit-et-obtenez-lebook>Soutenez notre site gratuit et obtenez l’ebook !</a></li></ol></li></ol></nav></details></aside><p><strong>Visiteur</strong> vous permet de séparer les algorithmes et les objets sur lesquels ils opèrent.</p><p><img src=https://deuxfois.github.io/quartz//../../_resources/visitor_df679eb372cc4b0f8e1e9d6c78e50bf2.png width=auto alt="Patron de conception visiteur"></p><a href=#problème><h2 id=problème><span class=hanchor arialabel=Anchor># </span>Problème</h2></a><p>Imaginez que votre équipe développe une application avec des informations géographiques qui prennent la forme d’un graphe géant. Chaque nœud du graphe peut représenter une entité complexe comme une ville, mais aussi des choses plus spécifiques comme des usines, des sites touristiques, etc. Les nœuds sont interconnectés s’il est possible de les relier. Dans le code, chaque type de nœud est représenté par sa propre classe et chaque nœud spécifique est un objet.</p><p><img src=https://deuxfois.github.io/quartz//../../_resources/problem1_eccc2e36b63e4ef3b40a70a9f6af4d61.png width=auto alt="Export du graphe en XML"></p><p>Export du graphe en XML.</p><p>Le jour vient où vous devez vous attaquer à la mise en place de l’export du graphe au format XML. À première vue, cela semble assez simple. Vous avez prévu de mettre en place une méthode d’export pour chaque classe nœud, puis vous exécutez la méthode sur chaque nœud du graphe en le parcourant récursivement. La solution était simple mais élégante : grâce au polymorphisme, vous n’avez pas couplé le code qui appelait la méthode d’exportation aux classes concrètes des nœuds.</p><p>Malheureusement, l’architecte du système vous a interdit de modifier les classes nœud existantes. Sa décision était basée sur le fait que le code était déjà en production et que vos modifications pourraient causer des bugs.</p><img width=500 height=0 src=../../_resources/problem2-fr_89e9ccd442f240638b2a5e39c23487c5.png><p>La méthode d’export XML devait être ajoutée dans toutes les classes nœud, ce qui risquait de compromettre l’intégrité du code de l’application.</p><p>De plus, il a remis en question la pertinence de placer le code d’export XML à l’intérieur des nœuds. Le rôle principal de ces classes est de manipuler les données géographiques, ce code serait perçu comme un intrus.</p><p>Il a avancé un autre argument contre votre modification. Il semblait très probable qu’une fois cette fonctionnalité en place, une personne du service marketing demande un export dans un format différent ou d’autres trucs bizarres. Cela vous obligerait à modifier une fois de plus ces petites classes fragiles.</p><a href=#solution><h2 id=solution><span class=hanchor arialabel=Anchor># </span>Solution</h2></a><p>Le patron de conception visiteur vous propose de placer ce nouveau comportement dans une classe séparée que l’on appelle <em>visiteur</em>, plutôt que de l’intégrer dans des classes existantes. L’objet qui devait lancer ce traitement à l’origine est maintenant passé en paramètre des méthodes du visiteur, ce qui permet à la méthode d’avoir accès à toutes les données nécessaires qui se trouvent à l’intérieur de l’objet.</p><p>Comment fait-on pour que ce comportement puisse être exécuté sur des objets de différentes classes ? Par exemple, dans le cas de notre export XML, l’implémentation sera probablement légèrement différente pour chaque nœud. La classe visiteur va donc avoir besoin d’un ensemble de méthodes et chacune d’entre elles pourra prendre des paramètres de différents types, comme ce qui suit :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>class ExportVisitor implements Visitor is
</span></span><span class=line><span class=cl>    method doForCity(City c) { ... }
</span></span><span class=line><span class=cl>    method doForIndustry(Industry f) { ... }
</span></span><span class=line><span class=cl>    method doForSightSeeing(SightSeeing ss) { ... }
</span></span><span class=line><span class=cl>    // ...
</span></span></code></pre></td></tr></table></div></div><p>Mais comment allons-nous appeler ces méthodes, surtout celles qui gèrent le graphe complet ? Nous ne pouvons pas utiliser le polymorphisme, car ces méthodes ont différentes signatures. Pour sélectionner une méthode qui peut traiter un objet donné, nous devons vérifier sa classe. On se croirait dans un cauchemar !</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>foreach (Node node in graph)
</span></span><span class=line><span class=cl>    if (node instanceof City)
</span></span><span class=line><span class=cl>        exportVisitor.doForCity((City) node)
</span></span><span class=line><span class=cl>    if (node instanceof Industry)
</span></span><span class=line><span class=cl>        exportVisitor.doForIndustry((Industry) node)
</span></span><span class=line><span class=cl>    // ...
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Il vous est peut-être venu à l’esprit d’utiliser la surcharge. La surcharge, c’est une technique qui permet de donner le même nom à toutes les méthodes, même si elles n’ont pas des paramètres identiques. Malheureusement, même si l’on suppose que notre langage de programmation nous le permet (le Java et le C# par exemple), cela ne nous sera d’aucune aide. Comme nous ne connaissons pas la classe d’un nœud à l’avance, le mécanisme de la surcharge ne sera pas capable de déterminer la bonne méthode à exécuter. Il ira systématiquement chercher la méthode qui prend un objet de la classe de base <code>Nœud</code>.</p><p>Heureusement, le patron de conception visiteur résout ce problème. Il utilise une technique appelée
<a href=https://refactoring.guru/fr/design-patterns/visitor-double-dispatch rel=noopener>double répartition</a> (double dispatch), qui aide à lancer la bonne méthode sans s’encombrer avec des blocs conditionnels. Plutôt que de laisser le client choisir la version de la méthode à appeler, pourquoi ne déléguons-nous pas la décision aux objets que nous passons en paramètre au visiteur ? Comme les objets connaissent leur propre classe, ils seront plus à même de choisir la méthode adaptée au visiteur. Ils « acceptent » un visiteur et lui indiquent la méthode à exécuter.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// Code client
</span></span><span class=line><span class=cl>foreach (Node node in graph)
</span></span><span class=line><span class=cl>    node.accept(exportVisitor)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// City
</span></span><span class=line><span class=cl>class City is
</span></span><span class=line><span class=cl>    method accept(Visitor v) is
</span></span><span class=line><span class=cl>        v.doForCity(this)
</span></span><span class=line><span class=cl>    // ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Industry
</span></span><span class=line><span class=cl>class Industry is
</span></span><span class=line><span class=cl>    method accept(Visitor v) is
</span></span><span class=line><span class=cl>        v.doForIndustry(this)
</span></span><span class=line><span class=cl>    // ...
</span></span></code></pre></td></tr></table></div></div><p>J’avoue. Nous avons finalement été obligés de toucher aux classes nœud. Mais cette modification est mineure et elle nous permet d’ajouter de nouveaux comportements sans avoir à retoucher le code.</p><p>À présent, si nous extrayons une interface pour tous les visiteurs, les nœuds existants vont accepter tous les visiteurs ajoutés dans l’application. Pour ajouter un nouveau comportement aux nœuds, il vous suffit d’implémenter une nouvelle classe visiteur.</p><a href=#analogie><h2 id=analogie><span class=hanchor arialabel=Anchor># </span>Analogie</h2></a><img width=600 height=0 src=../../_resources/visitor-comic-1_b1d8e2d074b04ab1ab50e9bbeed82412.png><p>Un bon agent d’assurance est toujours prêt à proposer différents contrats pour différentes organisations.</p><p>Imaginez un agent d’assurance expérimenté qui veut absolument acquérir de nouveaux clients. Il peut faire du porte-à-porte dans tous les bâtiments d’un quartier et essayer de vendre des assurances à tous ceux qu’il rencontre. En fonction du type d’entreprise qui occupe le bâtiment, il peut proposer des contrats d’assurance adaptés :</p><ul><li>Si c’est un bâtiment résidentiel, il vend des assurances maladie.</li><li>Si c’est une banque, il vend des assurances contre le vol.</li><li>Si c’est un café, il vend des assurances contre les incendies et les inondations.</li></ul><a href=#structure><h2 id=structure><span class=hanchor arialabel=Anchor># </span>Structure</h2></a><img width=520 height=0 src=../../_resources/structure-fr_015ddc89ef9a41748b0cc4d127f68aa6.png><ol><li><p>L’interface <strong>Visiteur</strong> déclare un ensemble de méthodes de parcours qui peuvent prendre les éléments concrets d’une structure d’objets en paramètre. Ces méthodes peuvent avoir le même nom si le programme est écrit dans un langage qui gère la surcharge, mais le type de ses paramètres sera différent.</p></li><li><p>Chaque <strong>Visiteur Concret</strong> implémente plusieurs versions des mêmes comportements, en fonction des classes des éléments concrets.</p></li><li><p>L’interface <strong>Élément</strong> déclare une méthode qui « accepte » les visiteurs. Cette méthode déclare un paramètre du type de l’interface visiteur.</p></li><li><p>Chaque <strong>Élément Concret</strong> doit implémenter une méthode d’acceptation. Le but de cette méthode est de rediriger l’appel vers la méthode appropriée du visiteur en fonction de la classe de l’élément actuel. Soyez conscient que même si la classe d’un élément de base implémente cette méthode, toutes les sous-classes doivent tout de même la redéfinir et appeler la méthode appropriée sur l’objet visiteur.</p></li><li><p>Le <strong>Client</strong> représente en général une collection ou tout autre objet complexe (par exemple un arbre
<a href=https://refactoring.guru/fr/design-patterns/composite rel=noopener>Composite</a>). En général, les clients n’ont pas de visibilité sur les classes des éléments concrets, car ils manipulent les objets de cette collection via une interface abstraite.</p></li></ol><a href=#pseudo-code><h2 id=pseudo-code><span class=hanchor arialabel=Anchor># </span>Pseudo-code</h2></a><p>Dans cet exemple, le <strong>Visiteur</strong> implémente l’export XML dans la hiérarchie de classes des formes géométriques.</p><img width=560 height=0 src=../../_resources/example_bcaf73dcdeb54b8b8320f858d9b4d5aa.png><p>Exporter différents types d’objets vers le format XML à l’aide d’un objet visiteur.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=o>//</span><span class=w> </span><span class=n>L</span><span class=err>’</span><span class=n>interface</span><span class=w> </span><span class=err>é</span><span class=n>lément</span><span class=w> </span><span class=n>déclare</span><span class=w> </span><span class=n>une</span><span class=w> </span><span class=n>méthode</span><span class=w> </span><span class=o>`</span><span class=n>accepter</span><span class=o>`</span><span class=w> </span><span class=n>qui</span><span class=w> </span><span class=n>prend</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>interface</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>base</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>en</span><span class=w> </span><span class=n>argument</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>interface</span><span class=w> </span><span class=n>Shape</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>move</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>draw</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=n>Visitor</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>Chaque</span><span class=w> </span><span class=n>classe</span><span class=w> </span><span class=n>concrète</span><span class=w> </span><span class=err>É</span><span class=n>lément</span><span class=w> </span><span class=n>doit</span><span class=w> </span><span class=n>implémenter</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>méthode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=o>`</span><span class=n>accepter</span><span class=o>`</span><span class=w> </span><span class=n>et</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>faire</span><span class=w> </span><span class=n>appeler</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>méthode</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>qui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>correspond</span><span class=w> </span><span class=err>à</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>classe</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>l</span><span class=err>’é</span><span class=n>lément</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>Dot</span><span class=w> </span><span class=n>implements</span><span class=w> </span><span class=n>Shape</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>Vous</span><span class=w> </span><span class=n>remarquerez</span><span class=w> </span><span class=n>que</span><span class=w> </span><span class=n>nous</span><span class=w> </span><span class=n>appelons</span><span class=w> </span><span class=o>`</span><span class=n>visiterPoint</span><span class=o>`</span><span class=p>,</span><span class=w> </span><span class=n>ce</span><span class=w> </span><span class=n>qui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>correspond</span><span class=w> </span><span class=n>au</span><span class=w> </span><span class=n>nom</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>classe</span><span class=w> </span><span class=n>actuelle</span><span class=p>.</span><span class=w> </span><span class=n>Ainsi</span><span class=p>,</span><span class=w> </span><span class=n>nous</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>fournissons</span><span class=w> </span><span class=n>le</span><span class=w> </span><span class=n>nom</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>classe</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>l</span><span class=err>’é</span><span class=n>lément</span><span class=w> </span><span class=n>au</span><span class=w> </span><span class=n>visiteur</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>qui</span><span class=w> </span><span class=n>le</span><span class=w> </span><span class=n>manipule</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=n>Visitor</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>v</span><span class=p>.</span><span class=nf>visitDot</span><span class=p>(</span><span class=n>this</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>Circle</span><span class=w> </span><span class=n>implements</span><span class=w> </span><span class=n>Shape</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=n>Visitor</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>v</span><span class=p>.</span><span class=nf>visitCircle</span><span class=p>(</span><span class=n>this</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>Rectangle</span><span class=w> </span><span class=n>implements</span><span class=w> </span><span class=n>Shape</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=n>Visitor</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>v</span><span class=p>.</span><span class=nf>visitRectangle</span><span class=p>(</span><span class=n>this</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>CompoundShape</span><span class=w> </span><span class=n>implements</span><span class=w> </span><span class=n>Shape</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>accept</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=n>Visitor</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>v</span><span class=p>.</span><span class=nf>visitCompoundShape</span><span class=p>(</span><span class=n>this</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>L</span><span class=err>’</span><span class=n>interface</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>déclare</span><span class=w> </span><span class=n>un</span><span class=w> </span><span class=n>ensemble</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>méthodes</span><span class=w> </span><span class=n>visiter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>qui</span><span class=w> </span><span class=n>correspondent</span><span class=w> </span><span class=n>aux</span><span class=w> </span><span class=n>classes</span><span class=w> </span><span class=err>é</span><span class=n>lément</span><span class=p>.</span><span class=w> </span><span class=n>La</span><span class=w> </span><span class=n>signature</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>méthode</span><span class=w> </span><span class=n>visiter</span><span class=w> </span><span class=n>permet</span><span class=w> </span><span class=n>au</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>d</span><span class=err>’</span><span class=n>identifier</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>classe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>exacte</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>l</span><span class=err>’é</span><span class=n>lément</span><span class=w> </span><span class=n>qu</span><span class=err>’</span><span class=n>il</span><span class=w> </span><span class=n>manipule</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>interface</span><span class=w> </span><span class=n>Visitor</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitDot</span><span class=p>(</span><span class=n>d</span><span class=p>:</span><span class=w> </span><span class=n>Dot</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitCircle</span><span class=p>(</span><span class=n>c</span><span class=p>:</span><span class=w> </span><span class=n>Circle</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitRectangle</span><span class=p>(</span><span class=n>r</span><span class=p>:</span><span class=w> </span><span class=n>Rectangle</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitCompoundShape</span><span class=p>(</span><span class=n>cs</span><span class=p>:</span><span class=w> </span><span class=n>CompoundShape</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>Les</span><span class=w> </span><span class=n>visiteurs</span><span class=w> </span><span class=n>concrets</span><span class=w> </span><span class=n>implémentent</span><span class=w> </span><span class=n>plusieurs</span><span class=w> </span><span class=n>versions</span><span class=w> </span><span class=n>du</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>même</span><span class=w> </span><span class=n>algorithme</span><span class=p>.</span><span class=w> </span><span class=n>Ce</span><span class=w> </span><span class=n>dernier</span><span class=w> </span><span class=n>fonctionne</span><span class=w> </span><span class=n>avec</span><span class=w> </span><span class=n>toutes</span><span class=w> </span><span class=n>les</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>classes</span><span class=w> </span><span class=n>concrètes</span><span class=w> </span><span class=err>É</span><span class=n>lément</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>Vous</span><span class=w> </span><span class=n>tirez</span><span class=w> </span><span class=n>tous</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>bénéfices</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>patron</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>conception</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>lorsque</span><span class=w> </span><span class=n>vous</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>utilisez</span><span class=w> </span><span class=n>avec</span><span class=w> </span><span class=n>une</span><span class=w> </span><span class=n>structure</span><span class=w> </span><span class=n>complexe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>d</span><span class=err>’</span><span class=n>objets</span><span class=p>,</span><span class=w> </span><span class=n>comme</span><span class=w> </span><span class=n>une</span><span class=w> </span><span class=n>arborescence</span><span class=p>.</span><span class=w> </span><span class=n>Dans</span><span class=w> </span><span class=n>ce</span><span class=w> </span><span class=n>cas</span><span class=p>,</span><span class=w> </span><span class=n>il</span><span class=w> </span><span class=n>peut</span><span class=w> </span><span class=err>ê</span><span class=n>tre</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>pratique</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>stocker</span><span class=w> </span><span class=n>certains</span><span class=w> </span><span class=err>é</span><span class=n>tats</span><span class=w> </span><span class=n>intermédiaires</span><span class=w> </span><span class=n>de</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>algorithme</span><span class=w> </span><span class=n>tout</span><span class=w> </span><span class=n>en</span><span class=w> </span><span class=n>exécutant</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>méthodes</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>sur</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>différents</span><span class=w> </span><span class=n>objets</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>structure</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>XMLExportVisitor</span><span class=w> </span><span class=n>implements</span><span class=w> </span><span class=n>Visitor</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitDot</span><span class=p>(</span><span class=n>d</span><span class=p>:</span><span class=w> </span><span class=n>Dot</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Exporte</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>ID</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=n>et</span><span class=w> </span><span class=n>ses</span><span class=w> </span><span class=n>coordonnées</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitCircle</span><span class=p>(</span><span class=n>c</span><span class=p>:</span><span class=w> </span><span class=n>Circle</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Exporte</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>ID</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>cercle</span><span class=p>,</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>coordonnées</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>son</span><span class=w> </span><span class=n>centre</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>et</span><span class=w> </span><span class=n>son</span><span class=w> </span><span class=n>rayon</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitRectangle</span><span class=p>(</span><span class=n>r</span><span class=p>:</span><span class=w> </span><span class=n>Rectangle</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Exporte</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>ID</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>rectangle</span><span class=p>,</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>coordonnées</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>point</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>supérieur</span><span class=w> </span><span class=n>gauche</span><span class=p>,</span><span class=w> </span><span class=n>ainsi</span><span class=w> </span><span class=n>que</span><span class=w> </span><span class=n>sa</span><span class=w> </span><span class=n>largeur</span><span class=w> </span><span class=n>et</span><span class=w> </span><span class=n>sa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>longueur</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>visitCompoundShape</span><span class=p>(</span><span class=n>cs</span><span class=p>:</span><span class=w> </span><span class=n>CompoundShape</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Exporte</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>ID</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>forme</span><span class=p>,</span><span class=w> </span><span class=n>ainsi</span><span class=w> </span><span class=n>qu</span><span class=err>’</span><span class=n>une</span><span class=w> </span><span class=n>liste</span><span class=w> </span><span class=n>des</span><span class=w> </span><span class=n>ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>ses</span><span class=w> </span><span class=n>enfants</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>Le</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=n>peut</span><span class=w> </span><span class=n>lancer</span><span class=w> </span><span class=n>des</span><span class=w> </span><span class=n>traitements</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>visiteur</span><span class=w> </span><span class=n>sur</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>n</span><span class=err>’</span><span class=n>importe</span><span class=w> </span><span class=n>quel</span><span class=w> </span><span class=n>ensemble</span><span class=w> </span><span class=n>d</span><span class=err>’é</span><span class=n>léments</span><span class=w> </span><span class=n>sans</span><span class=w> </span><span class=n>connaître</span><span class=w> </span><span class=n>leurs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>classes</span><span class=w> </span><span class=n>concrètes</span><span class=p>.</span><span class=w> </span><span class=n>La</span><span class=w> </span><span class=n>méthode</span><span class=w> </span><span class=n>accepter</span><span class=w> </span><span class=n>envoie</span><span class=w> </span><span class=n>un</span><span class=w> </span><span class=n>appel</span><span class=w> </span><span class=n>au</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>traitement</span><span class=w> </span><span class=n>approprié</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>objet</span><span class=w> </span><span class=n>visiteur</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>Application</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>field</span><span class=w> </span><span class=n>allShapes</span><span class=p>:</span><span class=w> </span><span class=n>array</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>Shapes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>export</span><span class=p>()</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>exportVisitor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>new</span><span class=w> </span><span class=nf>XMLExportVisitor</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nf>foreach</span><span class=w> </span><span class=p>(</span><span class=n>shape</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>allShapes</span><span class=p>)</span><span class=w> </span><span class=n>do</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>shape</span><span class=p>.</span><span class=nf>accept</span><span class=p>(</span><span class=n>exportVisitor</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Si vous voulez savoir pourquoi nous avons besoin d’une méthode <code>accepter</code> dans cet exemple, vous pouvez consulter mon article
<a href=https://refactoring.guru/fr/design-patterns/visitor-double-dispatch rel=noopener>Visiteur et Double répartition</a> qui décrit le sujet en détail.</p><a href=#possibilités-dapplication><h2 id=possibilités-dapplication><span class=hanchor arialabel=Anchor># </span>Possibilités d’application</h2></a><p>Utilisez le visiteur lorsque vous voulez lancer des traitements sur les éléments d’un objet ayant une structure complexe (une arborescence par exemple).</p><p>Le patron de conception visiteur vous permet de lancer des traitements sur un ensemble d’objets de différentes classes à l’aide d’un objet visiteur qui implémente une variante d’un même traitement pour chaque classe visée.</p><p>Utilisez le visiteur pour nettoyer la logique métier de tous les comportements secondaires.</p><p>Ce patron vous permet de spécialiser encore plus les classes principales de votre application, en transférant les autres comportements dans des classes visiteur.</p><p>Utilisez le visiteur si un comportement n’est adapté que pour certaines classes d’une hiérarchie de classes, mais pas pour les autres.</p><p>Vous pouvez envoyer ce comportement dans une classe visiteur séparée, implémenter seulement les méthodes de visite qui acceptent les objets des classes concernées et laisser le reste vide.</p><a href=#mise-en-œuvre><h2 id=mise-en-œuvre><span class=hanchor arialabel=Anchor># </span>Mise en œuvre</h2></a><ol><li><p>Déclarez l’interface visiteur avec un ensemble de méthodes « visiter » ; une pour chaque classe d’élément concret qui existe dans le programme.</p></li><li><p>Déclarez l’interface élément. Si vous avez déjà une hiérarchie de classes élément, ajoutez la méthode abstraite « accepter » à la classe de base de la hiérarchie. Cette méthode doit prendre un Visiteur en paramètre.</p></li><li><p>Implémentez les méthodes d’acceptation dans toutes les classes des éléments concrets. Ces méthodes doivent simplement rediriger l’appel vers la méthode de visite de l’objet visiteur qui correspond à la classe de l’élément actuel.</p></li><li><p>Les classes élément doivent uniquement interagir avec les visiteurs via l’interface visiteur. En revanche, les visiteurs doivent avoir la visibilité sur toutes les classes des éléments concrets, qui sont référencés comme les types des paramètres des méthodes de visite.</p></li><li><p>Pour chaque comportement qui ne peut être écrit à l’intérieur de la hiérarchie des éléments, créez une nouvelle classe concrète Visiteur et implémentez toutes les méthodes de visite.</p><p>Vous pourriez vous retrouver dans une situation où le visiteur aura besoin d’un accès aux membres privés d’une classe élément. Dans ce cas, vous pouvez rendre ces attributs ou méthodes publics (ce qui ne respecte pas l’encapsulation de l’élément) ou imbriquer la classe visiteur dans la classe de l’élément. Cette dernière possibilité n’est envisageable que si votre langage de programmation gère les classes imbriquées.</p></li><li><p>Le client doit créer des objets visiteur et les passer dans des éléments via des méthodes « accepter ».</p></li></ol><a href=#avantages-et-inconvénients><h2 id=avantages-et-inconvénients><span class=hanchor arialabel=Anchor># </span>Avantages et inconvénients</h2></a><ul><li><p><em>Principe ouvert/fermé</em>. Vous pouvez ajouter un nouveau comportement qui acceptera les objets de différentes classes sans les modifier.</p></li><li><p><em>Principe de responsabilité unique</em>. Vous pouvez déplacer plusieurs versions du même comportement dans une seule classe.</p></li><li><p>Un objet visiteur peut accumuler des informations utiles en manipulant différents objets. Cela peut se révéler pratique si vous voulez parcourir une structure complexe d’objets comme un arbre, et lancer le traitement du visiteur sur chaque objet de cette structure.</p></li><li><p>Vous devez mettre à jour les visiteurs chaque fois qu’une classe est ajoutée ou retirée de la hiérarchie des éléments.</p></li><li><p>Les visiteurs n’ont parfois pas les accès nécessaires aux attributs ou méthodes privés des éléments qu’ils sont censés manipuler.</p></li></ul><a href=#liens-avec-les-autres-patrons><h2 id=liens-avec-les-autres-patrons><span class=hanchor arialabel=Anchor># </span>Liens avec les autres patrons</h2></a><ul><li><p>Vous pouvez traiter le
<a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Visiteur</a> comme une version plus puissante du patron de conception
<a href=https://refactoring.guru/fr/design-patterns/command rel=noopener>Commande</a>. Ses objets peuvent lancer des traitements sur divers objets dans différentes classes.</p></li><li><p>Vous pouvez utiliser le
<a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Visiteur</a> pour lancer une opération sur un arbre
<a href=https://refactoring.guru/fr/design-patterns/composite rel=noopener>Composite</a> entier.</p></li><li><p>Vous pouvez utiliser le
<a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Visiteur</a> avec l’
<a href=https://refactoring.guru/fr/design-patterns/iterator rel=noopener>Itérateur</a> pour parcourir une structure de données complexe et lancer un traitement sur ses éléments, même s’ils ont des classes différentes.</p></li></ul><a href=#exemples-de-code><h2 id=exemples-de-code><span class=hanchor arialabel=Anchor># </span>Exemples de code</h2></a><p><a href=https://refactoring.guru/fr/design-patterns/visitor/java/example rel=noopener><img width=43 height=56 src=../../_resources/java_e0525d7ad18143148b216dffe26863e2.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/csharp/example rel=noopener><img width=43 height=56 src=../../_resources/csharp_5048387a95804fa08476c1bdd3e5d4be.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/cpp/example rel=noopener><img width=43 height=56 src=../../_resources/cpp_d9a26fa3c8ae4f058832f7fbcbcfd2c4.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/php/example rel=noopener><img width=43 height=56 src=../../_resources/php_56d76c08ed054db094717a24792e5f9e.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/python/example rel=noopener><img width=43 height=56 src=../../_resources/python_85e37f96fa184bf0a65f64d15251e846.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/ruby/example rel=noopener><img width=43 height=56 src=../../_resources/ruby_7932415689b6460599fa9bd24656184e.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/swift/example rel=noopener><img width=43 height=56 src=../../_resources/swift_141ec61410b942ffb3484e5270248cba.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/typescript/example rel=noopener><img width=43 height=56 src=../../_resources/typescript_3503798b09f54132b8a53d7e7316c0c2.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/visitor/go/example rel=noopener><img width=43 height=56 src=../../_resources/go_fd16a9b0507446f5acdd021abda97fc6.svg></a></p><a href=#informations-supplémentaires><h2 id=informations-supplémentaires><span class=hanchor arialabel=Anchor># </span>Informations supplémentaires</h2></a><ul><li>Vous demandez-vous toujours pourquoi vous ne pouvez pas remplacer le patron de conception visiteur par la surcharge ? Lisez mon article
<a href=https://refactoring.guru/fr/design-patterns/visitor-double-dispatch rel=noopener>Visiteur et double répartition</a> pour mieux comprendre ces vilains détails.</li></ul><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener><img width=200 height=200 src=../../_resources/patterns-book-banner-3_067889e7a692473bb183585cf31.png></a></p><a href=#soutenez-notre-site-gratuit-et-obtenez-lebook><h3 id=soutenez-notre-site-gratuit-et-obtenez-lebook><span class=hanchor arialabel=Anchor># </span>Soutenez notre site gratuit et obtenez l’ebook !</h3></a><ul><li>22 patrons de conception et 8 principes expliqués en profondeur.</li><li>444 pages de vulgarisation, bien structurées et faciles à lire.</li><li>225 illustrations et diagrammes clairs pour aider à la compréhension.</li><li>Une archive avec des exemples de code dans 9 langages.</li><li>Tous les appareils sont pris en charge : formats PDF/EPUB/MOBI/KFX.</li></ul><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener>En savoir plus…</a></p><a href=#suivant><h4 id=suivant><span class=hanchor arialabel=Anchor># </span>Suivant</h4></a><p><a href=https://refactoring.guru/fr/design-patterns/visitor-double-dispatch rel=noopener>Visiteur et double répartition</a></p><a href=#retour><h4 id=retour><span class=hanchor arialabel=Anchor># </span>Retour</h4></a><p><a href=https://refactoring.guru/fr/design-patterns/template-method rel=noopener>Patron de méthode</a></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener><img width=245 height=375 src=../../_resources/web-cover-fr_f421adc19d7e4ad1bce6e534c3d98019.png></a></p><p>Cet article est tiré de notre ebook
<strong>Plongée au cœur des
PATRONS DE CONCEPTION</strong></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener>En savoir plus…</a></p><p>Facebook</p><p>Twitter</p><ul><li><a href="https://feedback.refactoring.guru/?lang=en&show_feedback_form_private=true" rel=noopener>Nous contacter</a></li><li><a href=https://refactoring.guru/fr/login rel=noopener>Connexion</a></li></ul><p><a href=https://refactoring.guru/design-patterns/visitor rel=noopener>English</a>
<a href=https://refactoring.guru/es/design-patterns/visitor rel=noopener>Español</a>
<a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Français</a>
<a href=https://refactoring.guru/pl/design-patterns/visitor rel=noopener>Polski</a>
<a href=https://refactoring.guru/pt-br/design-patterns/visitor rel=noopener>Português-Br</a>
<a href=https://refactoring.guru/ru/design-patterns/visitor rel=noopener>Русский</a>
<a href=https://refactoring.guru/uk/design-patterns/visitor rel=noopener>Українська</a>
<a href=https://refactoringguru.cn/design-patterns/visitor rel=noopener>中文</a></p><p><a href=https://refactoring.guru/fr rel=noopener><img src=https://deuxfois.github.io/quartz//../../_resources/logo-covid-winter_dc7f44a6e8504378973c79837cbbcd98.png width=auto alt=Refactoring.Guru></a></p><p><img src=https://deuxfois.github.io/quartz//../../_resources/winter-hat_3ddd85238ad34d2e92fe5a16e7e29b33.png width=auto alt></p><ul><li><a href=https://refactoring.guru/fr/store rel=noopener>Contenu premium</a></li><li><a href=https://refactoring.guru/fr/design-patterns rel=noopener>Patrons de conception</a><ul><li><a href=https://refactoring.guru/fr/design-patterns/what-is-pattern rel=noopener>Introduction</a></li><li><a href=https://refactoring.guru/fr/design-patterns/catalog rel=noopener>Catalogue</a></li><li><a href=https://refactoring.guru/fr/design-patterns/creational-patterns rel=noopener>Patrons de création</a></li><li><a href=https://refactoring.guru/fr/design-patterns/structural-patterns rel=noopener>Patrons structurels</a></li><li><a href=https://refactoring.guru/fr/design-patterns/behavioral-patterns rel=noopener>Patrons comportementaux</a><ul><li><a href=https://refactoring.guru/fr/design-patterns/chain-of-responsibility rel=noopener>Chaîne de responsabilité</a></li><li><a href=https://refactoring.guru/fr/design-patterns/command rel=noopener>Commande</a></li><li><a href=https://refactoring.guru/fr/design-patterns/iterator rel=noopener>Itérateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/mediator rel=noopener>Médiateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Mémento</a></li><li><a href=https://refactoring.guru/fr/design-patterns/observer rel=noopener>Observateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/state rel=noopener>État</a></li><li><a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a></li><li><a href=https://refactoring.guru/fr/design-patterns/template-method rel=noopener>Patron de méthode</a></li><li><a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Visiteur</a></li></ul></li><li><a href=https://refactoring.guru/fr/design-patterns/examples rel=noopener>Exemples de code</a></li></ul></li><li><a href=https://refactoring.guru/fr/refactoring rel=noopener>Refactorisation (commenter bientôt)</a></li></ul><p><a href=https://refactoring.guru/fr/login rel=noopener>Connexion</a>
<a href="https://feedback.refactoring.guru/?lang=en" rel=noopener>Nous contacter</a></p><ul><li><a href=https://refactoring.guru/fr rel=noopener>Accueil</a></li><li><a href=https://refactoring.guru/fr/refactoring rel=noopener>Refactorisation</a></li><li><a href=https://refactoring.guru/fr/design-patterns rel=noopener>Patrons de conception</a></li><li><a href=https://refactoring.guru/fr/store rel=noopener>Contenu premium</a></li><li><a href="https://feedback.refactoring.guru/?lang=en" rel=noopener>Forum</a></li><li><a href="https://feedback.refactoring.guru/?lang=en&show_feedback_form_private=true" rel=noopener>Nous contacter</a></li></ul><p>2014-2021
<a href=https://refactoring.guru/fr rel=noopener>Refactoring.Guru</a>. Tous droits réservés.
<img src=https://deuxfois.github.io/quartz//../../_resources/fa-building_4b20b337243d479eb4cd2b39d7f3591a.svg width=auto alt="Organization address"> Khmelnitske shosse 19 / 27, Kamianets-Podilskyi, Ukraine, 32305
Email:
<a rel=noopener class="internal-link broken" data-src=mailto:support@refactoring.guru>support@refactoring.guru</a></p><p>Illustrations par
<a href=http://zhart.us/ rel=noopener>Dmitry Zhart</a></p><ul><li><a href=https://refactoring.guru/fr/terms rel=noopener>Termes et conditions</a></li><li><a href=https://refactoring.guru/fr/privacy-policy rel=noopener>Politique de protection de la vie privée</a></li><li><a href=https://refactoring.guru/fr/content-usage-policy rel=noopener>Politique de l’utilisation des données</a></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz/Architecture/Design_Pattern/Behavioral/Sommaire/ data-ctx=Visiteur data-src=/Architecture/Design_Pattern/Behavioral/Sommaire class=internal-link></a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://deuxfois.github.io/quartz/js/graph.afdb02e537635f9a611b53a988e5645b.js></script></div></div><div id=contact_buttons><footer><p>Made by DeuxFois using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://deuxfois.github.io/quartz/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div></div></body></html>