<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="État permet de modifier le comportement d’un objet lorsque son état interne change. L’objet donne l’impression qu’il change de classe."><title>État / State</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://deuxfois.github.io/quartz//icon.png><link href=https://deuxfois.github.io/quartz/styles.b54f56dc7e7fdf6be9a4427dc6b0509b.min.css rel=stylesheet><link href=https://deuxfois.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://deuxfois.github.io/quartz/js/darkmode.69b2c08ae0f08c3a3f86259a122e1f06.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/util.39f53d45cb9520bdaf946bd063598b19.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://deuxfois.github.io/quartz/js/popover.37b1455b8f0603154072b9467132c659.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://deuxfois.github.io/quartz/",fetchData=Promise.all([fetch("https://deuxfois.github.io/quartz/indices/linkIndex.ae532b25b7234418be730011680aea32.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://deuxfois.github.io/quartz/indices/contentIndex.d7a179423d348ae2ec5367e264b2b2a4.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://deuxfois.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://deuxfois.github.io/quartz",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/deuxfois.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://deuxfois.github.io/quartz/js/full-text-search.0ec5fb908204b9e13989f2c640c0870b.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://deuxfois.github.io/quartz/>⛄ DeuxFoi's blog</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>État / State</h1><p class=meta>Last updated
Aug 2, 2022
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/Architecture/Design_Pattern/Behavioral/Etat.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://deuxfois.github.io/quartz/tags/behavioral/>Behavioral</a></li><li><a href=https://deuxfois.github.io/quartz/tags/design_pattern/>Design pattern</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#problème>Problème</a></li><li><a href=#solution>Solution</a></li><li><a href=#analogie>Analogie</a></li><li><a href=#structure>Structure</a></li><li><a href=#pseudo-code>Pseudo-code</a></li><li><a href=#possibilités-dapplication>Possibilités d’application</a></li><li><a href=#mise-en-œuvre>Mise en œuvre</a></li><li><a href=#avantages-et-inconvénients>Avantages et inconvénients</a></li><li><a href=#liens-avec-les-autres-patrons>Liens avec les autres patrons</a></li><li><a href=#exemples-de-code>Exemples de code</a><ol><li><a href=#soutenez-notre-site-gratuit-et-obtenez-lebook>Soutenez notre site gratuit et obtenez l’ebook !</a></li></ol></li></ol></nav></details></aside><p><strong>État</strong> permet de modifier le comportement d’un objet lorsque son état interne change. L’objet donne l’impression qu’il change de classe.</p><p><img src=https://deuxfois.github.io/quartz//../../_resources/state-fr_7368c6b587874b7e830f220d8295c19a.png width=auto alt="Patron de conception état"></p><a href=#problème><h2 id=problème><span class=hanchor arialabel=Anchor># </span>Problème</h2></a><p>Le patron de conception est très proche du concept de l’
<a href=https://fr.wikipedia.org/wiki/Automate_fini rel=noopener>Automate fini</a>.</p><p><img src=https://deuxfois.github.io/quartz//../../_resources/problem1_e0c985d3f29c40609bb5ab30b1284951.png width=auto alt="Automate fini"></p><p>Automate fini.</p><p>Le principe repose sur le fait qu’un programme possède un nombre <em>fini</em> d&rsquo;<em>états</em>. Le programme se comporte différemment selon son état et peut en changer instantanément. En revanche, selon l’état dans lequel il se trouve, certains états ne lui sont pas accessibles. Ces règles de changement d’état sont appelées <em>transitions</em>. Elles sont également finies et prédéterminées.</p><p>Vous pouvez appliquer cette approche aux objets. Imaginons une classe <code>Document</code>. Un document peut être dans l’un des trois états suivants : <code>Brouillon</code> (draft), <code>Modération</code> et <code>Publié</code>. La méthode <code>publier</code> du document fonctionne un peu différemment en fonction de son état :</p><ul><li>Dans <code>Brouillon</code>, elle passe le document en modération.</li><li>Dans <code>Modération</code>, elle rend le document public si l’utilisateur actuel est un administrateur.</li><li>Dans <code>Publié</code>, elle ne fait rien du tout.</li></ul><img width=560 height=0 src=../../_resources/problem2-fr_ce199476de484ec080252139b51e6a21.png><p>Les états et transitions possibles d’un objet document.</p><p>Les automates sont généralement implémentés avec beaucoup d’opérateurs conditionnels (<code>if</code> ou <code>switch</code>) qui choisissent le comportement approprié en fonction de l’état actuel de l’objet. Cet « état » se limite souvent à un ensemble de valeurs dans les attributs de l’objet. Même si vous n’avez jamais entendu parler des automates finis, vous avez probablement déjà implémenté un état au moins une fois. La structure du code suivant vous dit-elle quelque chose ?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>class Document is
</span></span><span class=line><span class=cl>    field state: string
</span></span><span class=line><span class=cl>    // ...
</span></span><span class=line><span class=cl>    method publish() is
</span></span><span class=line><span class=cl>        switch (state)
</span></span><span class=line><span class=cl>            &#34;draft&#34;:
</span></span><span class=line><span class=cl>                state = &#34;moderation&#34;
</span></span><span class=line><span class=cl>                break
</span></span><span class=line><span class=cl>            &#34;moderation&#34;:
</span></span><span class=line><span class=cl>                if (currentUser.role == &#39;admin&#39;)
</span></span><span class=line><span class=cl>                    state = &#34;published&#34;
</span></span><span class=line><span class=cl>                break
</span></span><span class=line><span class=cl>            &#34;published&#34;:
</span></span><span class=line><span class=cl>                // Do nothing.
</span></span><span class=line><span class=cl>                break
</span></span><span class=line><span class=cl>    // ...
</span></span></code></pre></td></tr></table></div></div><p>La plus grosse faiblesse de l’automate fini devient visible lorsque l’on commence à ajouter de plus en plus d’états et de comportements qui en sont dépendants à la classe <code>Document</code>. La majorité des méthodes va contenir d’énormes blocs de conditions qui vont choisir le comportement d’une méthode en fonction de l’état actuel. Ce genre de code est très difficile à maintenir, car tout changement dans la logique de transition demande de modifier les états conditionnels dans chaque méthode.</p><p>Plus le projet évolue et plus cette faiblesse s’aggrave. Il est très difficile de prédire tous les états et transitions possibles lors de la phase de conception. Un automate fini doté d’un nombre limité de conditions peut se transformer en un bazar pas possible au bout d’un certain temps.</p><a href=#solution><h2 id=solution><span class=hanchor arialabel=Anchor># </span>Solution</h2></a><p>Le patron de conception état propose de créer de nouvelles classes pour tous les états possibles d’un objet et d’extraire les comportements liés aux états dans ces classes.</p><p>Plutôt que d’implémenter tous les comportements de lui-même, l’objet original que l’on nomme <em>contexte</em>, stocke une référence vers un des objets état qui représente son état actuel. Il délègue tout ce qui concerne la manipulation des états à cet objet.</p><img width=490 height=0 src=../../_resources/solution-fr_185ff9d6455c44a29778798580e63d51.png><p>Document délègue la tâche à un objet état.</p><p>Pour faire passer le contexte dans un autre état, remplacez l’objet état par un autre qui représente son nouvel état. Vous ne pourrez le faire que si toutes les classes suivent la même interface et si le contexte utilise cette dernière pour manipuler ces objets.</p><p>Cette structure ressemble de près au patron de conception
<a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a>, mais il y a une différence majeure. Dans le patron de conception état, les états ont de la visibilité entre eux et peuvent lancer les transitions d’un état à l’autre, alors que les stratégies ne peuvent pas se voir.</p><a href=#analogie><h2 id=analogie><span class=hanchor arialabel=Anchor># </span>Analogie</h2></a><p>Les boutons de votre smartphone fonctionnent différemment selon l’état de l’appareil :</p><ul><li>Si le téléphone est déverrouillé, appuyer sur des boutons lance différentes fonctionnalités.</li><li>Si le téléphone est verrouillé, appuyer sur n’importe quel bouton envoie sur l’écran de déverrouillage.</li><li>Si la batterie du téléphone est faible, appuyer sur n’importe quel bouton montre l’écran de charge.</li></ul><a href=#structure><h2 id=structure><span class=hanchor arialabel=Anchor># </span>Structure</h2></a><img width=540 height=0 src=../../_resources/structure-fr_212cf9cf716e49088232c0d41657b24d.png><ol><li><p>Le <strong>Contexte</strong> stocke une référence vers un des objets concrets État et lui délègue toutes les tâches concernant les états. Il utilise l’interface état pour communiquer avec l’objet état. Il expose un setter pour lui passer un nouvel état.</p></li><li><p>L’interface <strong>État</strong> déclare les méthodes spécifiques aux états. Ces méthodes doivent fonctionner avec tous les états concrets : des méthodes inutiles qui ne sont jamais appelées à l’intérieur de vos états sont à proscrire.</p></li><li><p>Les <strong>États Concrets</strong> fournissent leurs propres implémentations aux méthodes qui agissent sur les états. Pour éviter d’écrire le même code dans les différents états, vous pouvez créer des classes abstraites intermédiaires qui encapsulent les comportements identiques.</p><p>Les états peuvent garder une référence vers le contexte. Grâce à cette référence, l’état peut récupérer des informations depuis le contexte et lancer des transitions.</p></li><li><p>Le contexte et les états concrets peuvent modifier le prochain état du contexte et lancer une transition en remplaçant l’état lié au contexte.</p></li></ol><a href=#pseudo-code><h2 id=pseudo-code><span class=hanchor arialabel=Anchor># </span>Pseudo-code</h2></a><p>Dans cet exemple, le patron de conception <strong>État</strong> permet aux touches du lecteur multimédia d’avoir un comportement relatif à l’état actuel de la lecture.</p><img width=590 height=0 src=../../_resources/example_7f3ee819c1654a1da41ad9c13a1844f0.png><p>Un exemple de modification du comportement de l’objet effectué à l’aide d’objets état.</p><p>L’objet principal du lecteur est toujours associé à un objet état qui effectue la majeure partie du travail pour le lecteur. Certaines actions remplacent l’état actuel du lecteur par un autre, modifiant sa manière de réagir aux interactions de l’utilisateur.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// La classe lecteurAudio prend le rôle du contexte. Elle
</span></span><span class=line><span class=cl>// maintient également une référence vers l’instance de l’une
</span></span><span class=line><span class=cl>// des classes état qui représente l’état actuel du lecteur
</span></span><span class=line><span class=cl>// audio.
</span></span><span class=line><span class=cl>class AudioPlayer is
</span></span><span class=line><span class=cl>    field state: State
</span></span><span class=line><span class=cl>    field UI, volume, playlist, currentSong
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    constructor AudioPlayer() is
</span></span><span class=line><span class=cl>        this.state = new ReadyState(this)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        // Le contexte délègue la gestion des interventions de
</span></span><span class=line><span class=cl>        // l’utilisateur à un objet état. Le résultat va
</span></span><span class=line><span class=cl>        // évidemment dépendre de l&#39;état actuel, puisque chaque
</span></span><span class=line><span class=cl>        // état réagit différemment aux manipulations des
</span></span><span class=line><span class=cl>        // utilisateurs.
</span></span><span class=line><span class=cl>        UI = new UserInterface()
</span></span><span class=line><span class=cl>        UI.lockButton.onClick(this.clickLock)
</span></span><span class=line><span class=cl>        UI.playButton.onClick(this.clickPlay)
</span></span><span class=line><span class=cl>        UI.nextButton.onClick(this.clickNext)
</span></span><span class=line><span class=cl>        UI.prevButton.onClick(this.clickPrevious)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Les autres objets doivent pouvoir changer l&#39;état du
</span></span><span class=line><span class=cl>    // lecteur audio.
</span></span><span class=line><span class=cl>    method changeState(state: State) is
</span></span><span class=line><span class=cl>        this.state = state
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Les méthodes de l’UI délèguent l’exécution à l&#39;état
</span></span><span class=line><span class=cl>    // actuel.
</span></span><span class=line><span class=cl>    method clickLock() is
</span></span><span class=line><span class=cl>        state.clickLock()
</span></span><span class=line><span class=cl>    method clickPlay() is
</span></span><span class=line><span class=cl>        state.clickPlay()
</span></span><span class=line><span class=cl>    method clickNext() is
</span></span><span class=line><span class=cl>        state.clickNext()
</span></span><span class=line><span class=cl>    method clickPrevious() is
</span></span><span class=line><span class=cl>        state.clickPrevious()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Un état peut appeler les méthodes d’un service sur le
</span></span><span class=line><span class=cl>    // contexte.
</span></span><span class=line><span class=cl>    method startPlayback() is
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    method stopPlayback() is
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    method nextSong() is
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    method previousSong() is
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    method fastForward(time) is
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>    method rewind(time) is
</span></span><span class=line><span class=cl>        // ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// La classe de base état déclare des méthodes que tous les
</span></span><span class=line><span class=cl>// états concrets doivent obligatoirement implémenter et fournit
</span></span><span class=line><span class=cl>// aussi une référence arrière vers l’objet du contexte associé
</span></span><span class=line><span class=cl>// à l’état. Les états peuvent utiliser cette référence arrière
</span></span><span class=line><span class=cl>// pour permuter l’état du contexte.
</span></span><span class=line><span class=cl>abstract class State is
</span></span><span class=line><span class=cl>    protected field player: AudioPlayer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Le contexte s’envoie lui-même au constructeur de l’état,
</span></span><span class=line><span class=cl>    // permettant de donner un coup de pouce à l&#39;état pour
</span></span><span class=line><span class=cl>    // récupérer des données contextuelles si nécessaire.
</span></span><span class=line><span class=cl>    constructor State(player) is
</span></span><span class=line><span class=cl>        this.player = player
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    abstract method clickLock()
</span></span><span class=line><span class=cl>    abstract method clickPlay()
</span></span><span class=line><span class=cl>    abstract method clickNext()
</span></span><span class=line><span class=cl>    abstract method clickPrevious()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Les états concrets implémentent différents comportements
</span></span><span class=line><span class=cl>// associés à un état du contexte.
</span></span><span class=line><span class=cl>class LockedState extends State is
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Lorsque vous déverrouillez un lecteur verrouillé, il peut
</span></span><span class=line><span class=cl>    // prendre l’un des deux états.
</span></span><span class=line><span class=cl>    method clickLock() is
</span></span><span class=line><span class=cl>        if (player.playing)
</span></span><span class=line><span class=cl>            player.changeState(new PlayingState(player))
</span></span><span class=line><span class=cl>        else
</span></span><span class=line><span class=cl>            player.changeState(new ReadyState(player))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickPlay() is
</span></span><span class=line><span class=cl>        // Verrouillé, ne rien faire.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickNext() is
</span></span><span class=line><span class=cl>        // Verrouillé, ne rien faire.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickPrevious() is
</span></span><span class=line><span class=cl>        // Verrouillé, ne rien faire.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Ils peuvent également déclencher les transitions de l’état
</span></span><span class=line><span class=cl>// dans le contexte.
</span></span><span class=line><span class=cl>class ReadyState extends State is
</span></span><span class=line><span class=cl>    method clickLock() is
</span></span><span class=line><span class=cl>        player.changeState(new LockedState(player))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickPlay() is
</span></span><span class=line><span class=cl>        player.startPlayback()
</span></span><span class=line><span class=cl>        player.changeState(new PlayingState(player))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickNext() is
</span></span><span class=line><span class=cl>        player.nextSong()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickPrevious() is
</span></span><span class=line><span class=cl>        player.previousSong()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class PlayingState extends State is
</span></span><span class=line><span class=cl>    method clickLock() is
</span></span><span class=line><span class=cl>        player.changeState(new LockedState(player))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickPlay() is
</span></span><span class=line><span class=cl>        player.stopPlayback()
</span></span><span class=line><span class=cl>        player.changeState(new ReadyState(player))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickNext() is
</span></span><span class=line><span class=cl>        if (event.doubleclick)
</span></span><span class=line><span class=cl>            player.nextSong()
</span></span><span class=line><span class=cl>        else
</span></span><span class=line><span class=cl>            player.fastForward(5)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method clickPrevious() is
</span></span><span class=line><span class=cl>        if (event.doubleclick)
</span></span><span class=line><span class=cl>            player.previous()
</span></span><span class=line><span class=cl>        else
</span></span><span class=line><span class=cl>            player.rewind(5)
</span></span></code></pre></td></tr></table></div></div><a href=#possibilités-dapplication><h2 id=possibilités-dapplication><span class=hanchor arialabel=Anchor># </span>Possibilités d’application</h2></a><p>Utilisez le patron de conception état lorsque le comportement de l’un de vos objets varie en fonction de son état, qu’il y a beaucoup d’états différents et que ce code change souvent.</p><p>Ce patron vous propose d’extraire tout le code lié aux états et de le mettre dans des classes distinctes. Ceci vous permet d’ajouter de nouveaux états ou de modifier ceux qui existent indépendamment des autres, et de réduire les coûts de maintenance.</p><p>Utilisez ce patron si l’une de vos classes est polluée par d’énormes blocs conditionnels qui modifient le comportement de la classe en fonction de la valeur de ses attributs.</p><p>Le patron de conception état vous permet d’extraire des branches de ces conditions et de les transformer en méthodes dans les classes état. Tout en faisant vos modifications, vous pouvez retirer les attributs temporaires et les méthodes qui gèrent les changements d’état du code de votre classe principale.</p><p>Utilisez ce patron de conception si vous avez trop de code dupliqué dans des états et transitions similaires de votre automate.</p><p>Le patron de conception état vous permet d’assembler des hiérarchies de classes état et de réduire la duplication de code en regroupant le code commun dans des classes de base abstraites.</p><a href=#mise-en-œuvre><h2 id=mise-en-œuvre><span class=hanchor arialabel=Anchor># </span>Mise en œuvre</h2></a><ol><li><p>Choisissez la classe qui va prendre le rôle du contexte. Cette classe peut déjà exister et posséder du code qui gère les états, mais vous pouvez en créer une nouvelle si ce code est réparti dans plusieurs classes.</p></li><li><p>Déclarez l’interface état. Vous pourriez très bien vous contenter de recopier toutes les méthodes déclarées dans le contexte, mais ne reprenez que celles qui concernent les états.</p></li><li><p>Pour chaque état, créez une classe qui dérive de l’interface état. Parcourez ensuite les méthodes du contexte pour identifier le code qui concerne cet état et recopiez-le dans votre nouvelle classe.</p><p>En effectuant cette manipulation, vous pourriez tomber sur des membres privés dans le contexte. Il y a plusieurs moyens de contournement :</p><ul><li>Rendez ces attributs ou ces méthodes publics.</li><li>Transformez le comportement que vous extrayez en méthode publique que vous mettez dans le contexte, puis appelez-la depuis la classe état. Ce n’est pas le plus esthétique, mais vous pourrez revenir dessus plus tard.</li><li>Imbriquez les classes état dans la classe contexte si votre langage de programmation le permet.</li></ul></li><li><p>Dans votre classe contexte, ajoutez un attribut qui référence le type de l’interface état et un setter public qui permet de redéfinir la valeur de cet attribut.</p></li><li><p>Parcourez à nouveau les méthodes du contexte et remplacez les conditions concernant les états par des appels aux méthodes correspondantes de l’objet état.</p></li><li><p>Pour changer l’état du contexte, créez une instance de l’une des classes état et passez-la au contexte. Ceci peut être fait à l’intérieur du contexte, dans les différents états ou dans le client. Où qu’elle soit, cette classe devient dépendante de la classe concrète État qu’elle instancie.</p></li></ol><a href=#avantages-et-inconvénients><h2 id=avantages-et-inconvénients><span class=hanchor arialabel=Anchor># </span>Avantages et inconvénients</h2></a><ul><li><p><em>Principe de responsabilité unique</em>. Organisez le code lié aux différents états dans des classes séparées.</p></li><li><p><em>Principe ouvert/fermé</em>. Ajoutez de nouveaux états sans modifier les classes état ou le contexte existants.</p></li><li><p>Simplifiez le code du contexte en éliminant les gros blocs conditionnels de l’automate.</p></li><li><p>L’utilisation de ce patron est un peu exagérée si votre automate n’a que quelques états ou qu’il y a peu de transitions.</p></li></ul><a href=#liens-avec-les-autres-patrons><h2 id=liens-avec-les-autres-patrons><span class=hanchor arialabel=Anchor># </span>Liens avec les autres patrons</h2></a><ul><li><p>Le
<a href=https://refactoring.guru/fr/design-patterns/bridge rel=noopener>Pont</a>, l’
<a href=https://refactoring.guru/fr/design-patterns/state rel=noopener>État</a>, la
<a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a> (et dans une certaine mesure l’
<a href=https://refactoring.guru/fr/design-patterns/adapter rel=noopener>Adaptateur</a>) ont des structures très similaires. En effet, ces patrons sont basés sur la composition, qui délègue les tâches aux autres objets. Cependant, ils résolvent différents problèmes. Un patron n’est pas juste une recette qui vous aide à structurer votre code d’une certaine manière. C’est aussi une façon de communiquer aux autres développeurs le problème qu’il résout.</p></li><li><p>L’
<a href=https://refactoring.guru/fr/design-patterns/state rel=noopener>État</a> peut être considéré comme une extension de la
<a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a>. Ces deux patrons de conception sont basés sur la composition : ils changent le comportement du contexte en déléguant certaines tâches aux objets assistant. La <em>stratégie</em> rend ces objets complètement indépendants sans aucune visibilité l’un sur l’autre. Cependant, l’<em>état</em> n’impose pas de restrictions sur les dépendances entre les états concrets, et leur laisse modifier l’état du contexte à volonté.</p></li></ul><a href=#exemples-de-code><h2 id=exemples-de-code><span class=hanchor arialabel=Anchor># </span>Exemples de code</h2></a><p><a href=https://refactoring.guru/fr/design-patterns/state/java/example rel=noopener><img width=43 height=56 src=../../_resources/java_38e38a44146a41f085d0963bf27055be.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/csharp/example rel=noopener><img width=43 height=56 src=../../_resources/csharp_dcb24a4ad5c341f5b3d1305ad5379aca.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/cpp/example rel=noopener><img width=43 height=56 src=../../_resources/cpp_24eb3e52cf52406c89fc6ec8740adf4b.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/php/example rel=noopener><img width=43 height=56 src=../../_resources/php_57b0630edcdb438d8a4d674e2e20819f.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/python/example rel=noopener><img width=43 height=56 src=../../_resources/python_04f176c1ead64aadbd2a238fb21ce06d.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/ruby/example rel=noopener><img width=43 height=56 src=../../_resources/ruby_21c68026b9194c1d8d47445829541392.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/swift/example rel=noopener><img width=43 height=56 src=../../_resources/swift_0a5e43e4853747eda8130a799801c41c.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/typescript/example rel=noopener><img width=43 height=56 src=../../_resources/typescript_83004feed206441db270c9295c520a87.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/state/go/example rel=noopener><img width=43 height=56 src=../../_resources/go_1afbe281ebeb42c59c3e6b49f6a9a082.svg></a></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener><img width=200 height=200 src=../../_resources/patterns-book-banner-3_75b3edbae34c403987d97b67482.png></a></p><a href=#soutenez-notre-site-gratuit-et-obtenez-lebook><h3 id=soutenez-notre-site-gratuit-et-obtenez-lebook><span class=hanchor arialabel=Anchor># </span>Soutenez notre site gratuit et obtenez l’ebook !</h3></a><ul><li>22 patrons de conception et 8 principes expliqués en profondeur.</li><li>444 pages de vulgarisation, bien structurées et faciles à lire.</li><li>225 illustrations et diagrammes clairs pour aider à la compréhension.</li><li>Une archive avec des exemples de code dans 9 langages.</li><li>Tous les appareils sont pris en charge : formats PDF/EPUB/MOBI/KFX.</li></ul><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener>En savoir plus…</a></p><a href=#suivant><h4 id=suivant><span class=hanchor arialabel=Anchor># </span>Suivant</h4></a><p><a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a></p><a href=#retour><h4 id=retour><span class=hanchor arialabel=Anchor># </span>Retour</h4></a><p><a href=https://refactoring.guru/fr/design-patterns/observer rel=noopener>Observateur</a></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener><img width=245 height=375 src=../../_resources/web-cover-fr_17f812cb8d664ee5953e06b049846025.png></a></p><p>Cet article est tiré de notre ebook
<strong>Plongée au cœur des
PATRONS DE CONCEPTION</strong></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener>En savoir plus…</a></p><p>Facebook</p><p>Twitter</p><ul><li><a href="https://feedback.refactoring.guru/?lang=en&show_feedback_form_private=true" rel=noopener>Nous contacter</a></li><li><a href=https://refactoring.guru/fr/login rel=noopener>Connexion</a></li></ul><p><a href=https://refactoring.guru/design-patterns/state rel=noopener>English</a>
<a href=https://refactoring.guru/es/design-patterns/state rel=noopener>Español</a>
<a href=https://refactoring.guru/fr/design-patterns/state rel=noopener>Français</a>
<a href=https://refactoring.guru/pl/design-patterns/state rel=noopener>Polski</a>
<a href=https://refactoring.guru/pt-br/design-patterns/state rel=noopener>Português-Br</a>
<a href=https://refactoring.guru/ru/design-patterns/state rel=noopener>Русский</a>
<a href=https://refactoring.guru/uk/design-patterns/state rel=noopener>Українська</a>
<a href=https://refactoringguru.cn/design-patterns/state rel=noopener>中文</a></p><p><a href=https://refactoring.guru/fr rel=noopener><img src=https://deuxfois.github.io/quartz//../../_resources/logo-covid-winter_99a2bc13f2944cb2a3b459ecbb639f0a.png width=auto alt=Refactoring.Guru></a></p><p><img src=https://deuxfois.github.io/quartz//../../_resources/winter-hat_0830521447a542b0b0614e2dd748b019.png width=auto alt></p><ul><li><a href=https://refactoring.guru/fr/store rel=noopener>Contenu premium</a></li><li><a href=https://refactoring.guru/fr/design-patterns rel=noopener>Patrons de conception</a><ul><li><a href=https://refactoring.guru/fr/design-patterns/what-is-pattern rel=noopener>Introduction</a></li><li><a href=https://refactoring.guru/fr/design-patterns/catalog rel=noopener>Catalogue</a></li><li><a href=https://refactoring.guru/fr/design-patterns/creational-patterns rel=noopener>Patrons de création</a></li><li><a href=https://refactoring.guru/fr/design-patterns/structural-patterns rel=noopener>Patrons structurels</a></li><li><a href=https://refactoring.guru/fr/design-patterns/behavioral-patterns rel=noopener>Patrons comportementaux</a><ul><li><a href=https://refactoring.guru/fr/design-patterns/chain-of-responsibility rel=noopener>Chaîne de responsabilité</a></li><li><a href=https://refactoring.guru/fr/design-patterns/command rel=noopener>Commande</a></li><li><a href=https://refactoring.guru/fr/design-patterns/iterator rel=noopener>Itérateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/mediator rel=noopener>Médiateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Mémento</a></li><li><a href=https://refactoring.guru/fr/design-patterns/observer rel=noopener>Observateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/state rel=noopener>État</a></li><li><a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a></li><li><a href=https://refactoring.guru/fr/design-patterns/template-method rel=noopener>Patron de méthode</a></li><li><a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Visiteur</a></li></ul></li><li><a href=https://refactoring.guru/fr/design-patterns/examples rel=noopener>Exemples de code</a></li></ul></li><li><a href=https://refactoring.guru/fr/refactoring rel=noopener>Refactorisation (commenter bientôt)</a></li></ul><p><a href=https://refactoring.guru/fr/login rel=noopener>Connexion</a>
<a href="https://feedback.refactoring.guru/?lang=en" rel=noopener>Nous contacter</a></p><ul><li><a href=https://refactoring.guru/fr rel=noopener>Accueil</a></li><li><a href=https://refactoring.guru/fr/refactoring rel=noopener>Refactorisation</a></li><li><a href=https://refactoring.guru/fr/design-patterns rel=noopener>Patrons de conception</a></li><li><a href=https://refactoring.guru/fr/store rel=noopener>Contenu premium</a></li><li><a href="https://feedback.refactoring.guru/?lang=en" rel=noopener>Forum</a></li><li><a href="https://feedback.refactoring.guru/?lang=en&show_feedback_form_private=true" rel=noopener>Nous contacter</a></li></ul><p>2014-2021
<a href=https://refactoring.guru/fr rel=noopener>Refactoring.Guru</a>. Tous droits réservés.
<img src=https://deuxfois.github.io/quartz//../../_resources/fa-building_4c438f64160147cfbe29175337a1960c.svg width=auto alt="Organization address"> Khmelnitske shosse 19 / 27, Kamianets-Podilskyi, Ukraine, 32305
Email:
<a rel=noopener class="internal-link broken" data-src=mailto:support@refactoring.guru>support@refactoring.guru</a></p><p>Illustrations par
<a href=http://zhart.us/ rel=noopener>Dmitry Zhart</a></p><ul><li><a href=https://refactoring.guru/fr/terms rel=noopener>Termes et conditions</a></li><li><a href=https://refactoring.guru/fr/privacy-policy rel=noopener>Politique de protection de la vie privée</a></li><li><a href=https://refactoring.guru/fr/content-usage-policy rel=noopener>Politique de l’utilisation des données</a></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz/Architecture/Design_Pattern/Behavioral/Sommaire/ data-ctx=État data-src=/Architecture/Design_Pattern/Behavioral/Sommaire class=internal-link></a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://deuxfois.github.io/quartz/js/graph.243ea0d4fc79317e06f846bd698ba136.js></script></div></div><div id=contact_buttons><footer><p>Made by DeuxFois using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://deuxfois.github.io/quartz/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div></div></body></html>