<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Singleton qui garantit que l’instance d’une classe n’existe qu’en un seul exemplaire, tout en fournissant un point d’accès global à cette instance."><title>Singleton</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://deuxfois.github.io/quartz//icon.png><link href=https://deuxfois.github.io/quartz/styles.b54f56dc7e7fdf6be9a4427dc6b0509b.min.css rel=stylesheet><link href=https://deuxfois.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://deuxfois.github.io/quartz/js/darkmode.69b2c08ae0f08c3a3f86259a122e1f06.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/util.39f53d45cb9520bdaf946bd063598b19.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://deuxfois.github.io/quartz/js/popover.37b1455b8f0603154072b9467132c659.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://deuxfois.github.io/quartz/",fetchData=Promise.all([fetch("https://deuxfois.github.io/quartz/indices/linkIndex.ae532b25b7234418be730011680aea32.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://deuxfois.github.io/quartz/indices/contentIndex.d7a179423d348ae2ec5367e264b2b2a4.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://deuxfois.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://deuxfois.github.io/quartz",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/deuxfois.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://deuxfois.github.io/quartz/js/full-text-search.0ec5fb908204b9e13989f2c640c0870b.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://deuxfois.github.io/quartz/>⛄ DeuxFoi's blog</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Singleton</h1><p class=meta>Last updated
Aug 2, 2022
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/Architecture/Design_Pattern/Creation/Singleton.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://deuxfois.github.io/quartz/tags/cr%C3%A9ation/>Création</a></li><li><a href=https://deuxfois.github.io/quartz/tags/design_pattern/>Design pattern</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#problème>Problème</a></li><li><a href=#solution>Solution</a></li><li><a href=#analogie>Analogie</a></li><li><a href=#structure>Structure</a></li></ol><ol><li><a href=#mise-en-œuvre>Mise en œuvre</a></li><li><a href=#avantages-et-inconvénients>Avantages et inconvénients</a></li><li><a href=#liens-avec-les-autres-patrons>Liens avec les autres patrons</a></li></ol></nav></details></aside><p><strong>Singleton</strong> qui garantit que l’instance d’une classe n’existe qu’en un seul exemplaire, tout en fournissant un point d’accès global à cette instance.</p><p><img src=https://deuxfois.github.io/quartz//../../_resources/singleton_ba9b2561ee0d490aaadcb7303de061bb.png width=auto alt="Patron de conception singleton"></p><a href=#problème><h2 id=problème><span class=hanchor arialabel=Anchor># </span>Problème</h2></a><p>Le singleton règle deux problèmes à la fois, mais ne respecte pas le <em>principe de responsabilité unique</em>.</p><ol><li><p><strong>Il garantit l’unicité d’une instance pour une classe</strong>. Pour quelle raison voudrait-on maîtriser le nombre d’instances d’une classe ? En général, cette situation se présente lorsque l’on veut contrôler l’accès à une ressource partagée — une base de données ou un fichier par exemple.</p><p>Son fonctionnement est le suivant : vous créez un objet, mais après un certain temps, vous décidez d’en créer un autre. Plutôt que de vous retrouver avec un objet flambant neuf, vous récupérez celui qui existe déjà.</p><p>Vous noterez qu’il est impossible d’implémenter ce comportement avec un constructeur normal, puisqu’un constructeur <strong>doit</strong> théoriquement toujours retourner un nouvel objet.</p></li></ol><img width=600 height=0 src=../../_resources/singleton-comic-1-fr_d60c6bbe8d704b20939216b206393.png class=jop-noMdConv><p>Les clients ne se rendent pas forcément compte qu’ils travaillent toujours avec le même objet.</p><ol start=2><li><p><strong>Il fournit un point d’accès global à cette instance</strong>. Vous rappelez-vous ces variables globales que vous (bon, d’accord : moi) avez utilisées pour stocker des objets essentiels ? Elles sont très pratiques mais peu fiables, puisque n’importe quelle partie du code peut potentiellement écraser leur contenu et faire planter l’application.</p><p>Le singleton vous permet d’accéder à l’objet n’importe où dans le programme, telle une variable globale. Cependant, il protège son instance et l’empêche d’être modifiée.</p><p>Un autre aspect majeur vient se glisser dans l’équation : le code qui résout le problème numéro 1 ne doit pas se retrouver éparpillé dans tout le programme. En effet, on préfèrera tout mettre dans une même classe, surtout si le reste du code repose dessus.</p></li></ol><p>Aujourd’hui, le singleton est devenu très populaire et le terme <em>singleton</em> est même parfois employé pour une entité ne résolvant qu’un seul des problèmes listés.</p><a href=#solution><h2 id=solution><span class=hanchor arialabel=Anchor># </span>Solution</h2></a><p>Toute mise en place d’un singleton est constituée des deux étapes suivantes :</p><ul><li>Rendre le constructeur par défaut privé afin d’empêcher les autres objets d’utiliser l’opérateur <code>new</code> avec la classe du singleton.</li><li>Mettre en place une méthode de création statique qui se comporte comme un constructeur. En sous-main, cette méthode appelle le constructeur privé pour créer un objet et le sauvegarde dans un attribut statique. Tous les appels ultérieurs à cette méthode retournent l’objet en cache.</li></ul><p>Si votre code a accès à la classe du singleton, alors il peut appeler sa méthode statique. À chaque appel de cette méthode, c’est toujours le même objet qui est retourné.</p><a href=#analogie><h2 id=analogie><span class=hanchor arialabel=Anchor># </span>Analogie</h2></a><p>Prenons le gouvernement, qui est un excellent exemple de singleton. Un pays ne peut avoir qu’un seul gouvernement officiel. Quels que soient les individus qui composent un gouvernement, l’appellation « Le gouvernement de X » est un point global d’accès qui identifie le groupe de personnes au pouvoir.</p><a href=#structure><h2 id=structure><span class=hanchor arialabel=Anchor># </span>Structure</h2></a><img width=430 height=0 src=../../_resources/structure-fr_0077d431ddc14bb68670192688424664.png class=jop-noMdConv><ol><li><p>La classe <strong>Singleton</strong> déclare la méthode statique <code>getInstance</code> qui retourne la même instance de sa propre classe.</p><p>Le code client ne doit pas avoir de visibilité sur le constructeur du singleton. Seule la méthode <code>getInstance</code> doit permettre l’accès à l’objet du singleton.</p></li></ol><a href=#pseudo-code><h1 id=pseudo-code><span class=hanchor arialabel=Anchor># </span>Pseudo-code</h1></a><p>Dans cet exemple, la classe de la connexion à la base de données est le <strong>Singleton</strong>. Cette classe n’a pas de constructeur public, vous ne pouvez y accéder que grâce à la méthode <code>getInstance</code>. Cette méthode met en cache le premier objet créé puis retourne ce même objet lors des appels ultérieurs.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=o>//</span><span class=w> </span><span class=n>La</span><span class=w> </span><span class=n>classe</span><span class=w> </span><span class=n>baseDeDonnées</span><span class=w> </span><span class=n>définit</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>méthode</span><span class=w> </span><span class=o>`</span><span class=n>getInstance</span><span class=o>`</span><span class=w> </span><span class=n>qui</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>permet</span><span class=w> </span><span class=n>aux</span><span class=w> </span><span class=n>clients</span><span class=w> </span><span class=n>d</span><span class=err>’</span><span class=n>accéder</span><span class=w> </span><span class=err>à</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>même</span><span class=w> </span><span class=n>instance</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>connexion</span><span class=w> </span><span class=err>à</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>base</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>données</span><span class=w> </span><span class=n>dans</span><span class=w> </span><span class=n>tout</span><span class=w> </span><span class=n>le</span><span class=w> </span><span class=n>programme</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=k>Database</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>L</span><span class=err>’</span><span class=n>attribut</span><span class=w> </span><span class=n>qui</span><span class=w> </span><span class=n>stocke</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>instance</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>singleton</span><span class=w> </span><span class=n>doit</span><span class=w> </span><span class=err>ê</span><span class=n>tre</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=err>‘</span><span class=n>static</span><span class=err>’</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>private</span><span class=w> </span><span class=n>static</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=n>instance</span><span class=p>:</span><span class=w> </span><span class=k>Database</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>Le</span><span class=w> </span><span class=n>constructeur</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=n>singleton</span><span class=w> </span><span class=n>doit</span><span class=w> </span><span class=n>toujours</span><span class=w> </span><span class=err>ê</span><span class=n>tre</span><span class=w> </span><span class=n>privé</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>afin</span><span class=w> </span><span class=n>d</span><span class=err>’</span><span class=n>empêcher</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>appels</span><span class=w> </span><span class=err>à</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>opérateur</span><span class=w> </span><span class=o>`</span><span class=n>new</span><span class=o>`</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>private</span><span class=w> </span><span class=n>constructor</span><span class=w> </span><span class=k>Database</span><span class=p>()</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Code</span><span class=w> </span><span class=n>d</span><span class=err>’</span><span class=nf>initialisation</span><span class=w> </span><span class=p>(</span><span class=n>la</span><span class=w> </span><span class=n>connexion</span><span class=w> </span><span class=n>au</span><span class=w> </span><span class=n>serveur</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>base</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>données</span><span class=w> </span><span class=n>par</span><span class=w> </span><span class=n>exemple</span><span class=p>).</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>La</span><span class=w> </span><span class=n>méthode</span><span class=w> </span><span class=n>statique</span><span class=w> </span><span class=n>qui</span><span class=w> </span><span class=n>contrôle</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>accès</span><span class=w> </span><span class=err>à</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>instance</span><span class=w> </span><span class=n>du</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>singleton</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>public</span><span class=w> </span><span class=n>static</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=nf>getInstance</span><span class=p>()</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>Database</span><span class=p>.</span><span class=n>instance</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=no>null</span><span class=p>)</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nf>acquireThreadLock</span><span class=p>()</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>//</span><span class=w> </span><span class=n>Ce</span><span class=w> </span><span class=n>thread</span><span class=w> </span><span class=n>attend</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>levée</span><span class=w> </span><span class=n>du</span><span class=w> </span><span class=nf>verrou</span><span class=w> </span><span class=p>(</span><span class=k>lock</span><span class=p>)</span><span class=w> </span><span class=n>le</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>//</span><span class=w> </span><span class=n>temps</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>s</span><span class=err>’</span><span class=n>assurer</span><span class=w> </span><span class=n>que</span><span class=w> </span><span class=n>l</span><span class=err>’</span><span class=n>instance</span><span class=w> </span><span class=n>n</span><span class=err>’</span><span class=n>a</span><span class=w> </span><span class=n>pas</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=o>//</span><span class=w> </span><span class=n>déjà</span><span class=w> </span><span class=err>é</span><span class=n>té</span><span class=w> </span><span class=n>initialisée</span><span class=w> </span><span class=n>dans</span><span class=w> </span><span class=n>un</span><span class=w> </span><span class=n>autre</span><span class=w> </span><span class=n>thread</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>Database</span><span class=p>.</span><span class=n>instance</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=no>null</span><span class=p>)</span><span class=w> </span><span class=k>then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>Database</span><span class=p>.</span><span class=n>instance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>new</span><span class=w> </span><span class=k>Database</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>Database</span><span class=p>.</span><span class=n>instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>Pour</span><span class=w> </span><span class=n>finir</span><span class=p>,</span><span class=w> </span><span class=n>tout</span><span class=w> </span><span class=n>singleton</span><span class=w> </span><span class=n>doit</span><span class=w> </span><span class=n>définir</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>logique</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>//</span><span class=w> </span><span class=n>métier</span><span class=w> </span><span class=n>qui</span><span class=w> </span><span class=n>peut</span><span class=w> </span><span class=err>ê</span><span class=n>tre</span><span class=w> </span><span class=n>exécutée</span><span class=w> </span><span class=n>dans</span><span class=w> </span><span class=n>sa</span><span class=w> </span><span class=n>propre</span><span class=w> </span><span class=n>instance</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>public</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=nf>query</span><span class=p>(</span><span class=k>sql</span><span class=p>)</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Par</span><span class=w> </span><span class=n>exemple</span><span class=p>,</span><span class=w> </span><span class=n>toutes</span><span class=w> </span><span class=n>les</span><span class=w> </span><span class=n>requêtes</span><span class=w> </span><span class=n>sur</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>base</span><span class=w> </span><span class=n>de</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>données</span><span class=w> </span><span class=n>d</span><span class=err>’</span><span class=n>une</span><span class=w> </span><span class=n>application</span><span class=w> </span><span class=n>passent</span><span class=w> </span><span class=n>par</span><span class=w> </span><span class=n>cette</span><span class=w> </span><span class=n>méthode</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>Par</span><span class=w> </span><span class=n>conséquent</span><span class=p>,</span><span class=w> </span><span class=n>vous</span><span class=w> </span><span class=n>pouvez</span><span class=w> </span><span class=n>définir</span><span class=w> </span><span class=n>le</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=n>des</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>limitations</span><span class=w> </span><span class=n>ou</span><span class=w> </span><span class=n>de</span><span class=w> </span><span class=n>la</span><span class=w> </span><span class=n>mise</span><span class=w> </span><span class=n>en</span><span class=w> </span><span class=n>cache</span><span class=w> </span><span class=n>ici</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>class</span><span class=w> </span><span class=n>Application</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>method</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=k>is</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Database</span><span class=w> </span><span class=n>foo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Database</span><span class=p>.</span><span class=nf>getInstance</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>foo</span><span class=p>.</span><span class=nf>query</span><span class=p>(</span><span class=s2>&#34;SELECT  ...&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>Database</span><span class=w> </span><span class=n>bar</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Database</span><span class=p>.</span><span class=nf>getInstance</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>bar</span><span class=p>.</span><span class=nf>query</span><span class=p>(</span><span class=s2>&#34;SELECT  ...&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>La</span><span class=w> </span><span class=n>variable</span><span class=w> </span><span class=o>`</span><span class=n>bar</span><span class=o>`</span><span class=w> </span><span class=n>contiendra</span><span class=w> </span><span class=n>le</span><span class=w> </span><span class=n>même</span><span class=w> </span><span class=n>objet</span><span class=w> </span><span class=n>que</span><span class=w> </span><span class=n>la</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>//</span><span class=w> </span><span class=n>variable</span><span class=w> </span><span class=o>`</span><span class=n>foo</span><span class=o>`</span><span class=p>.</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><a href=#possibilités-dapplication><h1 id=possibilités-dapplication><span class=hanchor arialabel=Anchor># </span>Possibilités d’application</h1></a><p>Utilisez le singleton lorsque l’une de vos classes ne doit fournir qu’une seule instance à tous ses clients. Par exemple, une base de données partagée entre toutes les parties d’un programme.</p><p>La méthode spéciale de création devient le seul moyen de fabriquer des objets pour la classe, car le singleton désactive les autres. Cette méthode crée un objet ou retourne l’objet existant s’il a déjà été créé.</p><p>Utilisez le singleton lorsque vous voulez un contrôle absolu sur vos variables globales.</p><p>Contrairement aux variables globales, le singleton garantit l’unicité de l’instance de la classe. Seule la classe singleton peut remplacer l’instance mise en cache.</p><p>Vous pouvez moduler le nombre d’instances du singleton comme vous le voulez. Vous devez juste apporter une modification dans le corps de la méthode <code>getInstance</code>.</p><a href=#mise-en-œuvre><h2 id=mise-en-œuvre><span class=hanchor arialabel=Anchor># </span>Mise en œuvre</h2></a><ol><li><p>Ajoutez un attribut statique à la classe pour stocker l’instance du singleton.</p></li><li><p>Déclarez une méthode de création publique et statique pour récupérer l’instance du singleton.</p></li><li><p>Implémentez une « instanciation paresseuse » (lazy initialization) à l’intérieur de la méthode statique. Elle devrait créer un nouvel objet lors du premier appel et le stocker dans l’attribut statique. La méthode doit retourner cette instance lors de tous les appels suivants.</p></li><li><p>Rendez privé le constructeur de la classe. La méthode statique de la classe doit être la seule à pouvoir appeler le constructeur.</p></li><li><p>Parcourez le code client et remplacez les appels directs au constructeur du singleton par des appels à la méthode statique.</p></li></ol><a href=#avantages-et-inconvénients><h2 id=avantages-et-inconvénients><span class=hanchor arialabel=Anchor># </span>Avantages et inconvénients</h2></a><ul><li><p>Vous garantissez l’unicité de l’instance de la classe.</p></li><li><p>Vous obtenez un point d’accès global à cette instance.</p></li><li><p>l’objet du singleton est uniquement initialisé la première fois qu’il est appelé.</p></li><li><p>Ne respecte pas le <em>principe de responsabilité unique</em>. Ce patron résout deux problèmes à la fois.</p></li><li><p>Le singleton peut masquer une mauvaise conception ; il se peut, par exemple, que les composants aient trop de visibilité les uns envers les autres.</p></li><li><p>Il doit bénéficier d’un traitement spécial pour fonctionner dans un environnement multithread afin que le singleton ne se retrouve pas en plusieurs exemplaires.</p></li><li><p>Les tests unitaires du code client peuvent se révéler difficiles, car de nombreux frameworks reposent sur l’héritage lorsqu’ils créent des objets fictifs. Étant donné que le constructeur de la classe du singleton est privé et que redéfinir la méthode statique est impossible dans la majorité des langages, vous allez devoir être créatif pour reproduire un singleton fictif. Ou ne pas faire de tests. Ou ne pas utiliser de singleton.</p></li></ul><a href=#liens-avec-les-autres-patrons><h2 id=liens-avec-les-autres-patrons><span class=hanchor arialabel=Anchor># </span>Liens avec les autres patrons</h2></a><ul><li><p>Une classe
<a href=https://refactoring.guru/fr/design-patterns/facade rel=noopener>Façade</a> peut souvent être transformée en
<a href=https://refactoring.guru/fr/design-patterns/singleton rel=noopener>Singleton</a>, car un seul objet façade est en général suffisant.</p></li><li><p>Le
<a href=https://refactoring.guru/fr/design-patterns/flyweight rel=noopener>Poids mouche</a> ressemble au
<a href=https://refactoring.guru/fr/design-patterns/singleton rel=noopener>Singleton</a> si vous parvenez à compiler tous les états partagés des objets en un seul objet poids mouche. Mais ces patrons de conception ont deux différences fondamentales :</p><ol><li>Il ne devrait y avoir qu’une seule instance de singleton, mais une classe <em>poids mouche</em> peut avoir plusieurs instances avec différents états intrinsèques.</li><li>L’objet <em>singleton</em> peut être modifiable alors que les objets poids mouche ne sont pas modifiables.</li></ol></li><li><p>Les
<a href=https://refactoring.guru/fr/design-patterns/abstract-factory rel=noopener>Fabriques abstraites</a>,
<a href=https://refactoring.guru/fr/design-patterns/builder rel=noopener>Monteurs</a> et
<a href=https://refactoring.guru/fr/design-patterns/prototype rel=noopener>Prototypes</a> peuvent tous être implémentés comme des
<a href=https://refactoring.guru/fr/design-patterns/singleton rel=noopener>Singletons</a>.</p></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz/Architecture/Design_Pattern/Creation/Sommaire/ data-ctx=Singleton data-src=/Architecture/Design_Pattern/Creation/Sommaire class=internal-link></a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://deuxfois.github.io/quartz/js/graph.243ea0d4fc79317e06f846bd698ba136.js></script></div></div><div id=contact_buttons><footer><p>Made by DeuxFois using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://deuxfois.github.io/quartz/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div></div></body></html>