<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Mémento permet de sauvegarder et de rétablir l’état précédent d’un objet sans révéler les détails de son implémentation.
 Problème Imaginez que vous êtes en train de créer un éditeur de texte."><title>Mémento / Memento</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://deuxfois.github.io/quartz//icon.png><link href=https://deuxfois.github.io/quartz/styles.b54f56dc7e7fdf6be9a4427dc6b0509b.min.css rel=stylesheet><link href=https://deuxfois.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://deuxfois.github.io/quartz/js/darkmode.69b2c08ae0f08c3a3f86259a122e1f06.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/util.39f53d45cb9520bdaf946bd063598b19.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://deuxfois.github.io/quartz/js/popover.37b1455b8f0603154072b9467132c659.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://deuxfois.github.io/quartz/",fetchData=Promise.all([fetch("https://deuxfois.github.io/quartz/indices/linkIndex.3b4e6d48a296906ef79bdbe4f350bfdc.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://deuxfois.github.io/quartz/indices/contentIndex.053b592927a81ddfe48647decd78b1ef.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://deuxfois.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://deuxfois.github.io/quartz",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/deuxfois.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://deuxfois.github.io/quartz/js/full-text-search.0ec5fb908204b9e13989f2c640c0870b.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://deuxfois.github.io/quartz/>⛄ DeuxFoi's blog</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Mémento / Memento</h1><p class=meta>Last updated
Aug 4, 2022
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/Architecture/Design-Pattern/Behavioral/Memento.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://deuxfois.github.io/quartz/tags/behavioral/>Behavioral</a></li><li><a href=https://deuxfois.github.io/quartz/tags/design_pattern/>Design pattern</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#problème>Problème</a></li><li><a href=#solution>Solution</a></li><li><a href=#structure>Structure</a><ol><li></li></ol></li><li><a href=#pseudo-code>Pseudo-code</a></li><li><a href=#possibilités-dapplication>Possibilités d’application</a></li><li><a href=#mise-en-œuvre>Mise en œuvre</a></li><li><a href=#avantages-et-inconvénients>Avantages et inconvénients</a></li><li><a href=#liens-avec-les-autres-patrons>Liens avec les autres patrons</a></li><li><a href=#exemples-de-code>Exemples de code</a><ol><li><a href=#soutenez-notre-site-gratuit-et-obtenez-lebook>Soutenez notre site gratuit et obtenez l’ebook !</a></li></ol></li></ol></nav></details></aside><p><strong>Mémento</strong> permet de sauvegarder et de rétablir l’état précédent d’un objet sans révéler les détails de son implémentation.</p><p><img src=https://deuxfois.github.io/quartz//../../_resources/memento-fr_66e03e2a2fea4a8282a85380144a01fa.png width=auto alt="Patron de conception mémento"></p><a href=#problème><h2 id=problème><span class=hanchor arialabel=Anchor># </span>Problème</h2></a><p>Imaginez que vous êtes en train de créer un éditeur de texte. En plus de pouvoir écrire du texte, votre éditeur permet de le formater, d’insérer des images alignées, etc.</p><p>Au bout d’un moment, vous décidez d’ajouter une fonctionnalité qui permet aux utilisateurs d’annuler une action sur le texte. Cette fonctionnalité est devenue si classique au fil des années, que les utilisateurs s’attendent systématiquement à en disposer. Vous choisissez une approche directe pour la mettre en place. Avant d’effectuer une action, l’application enregistre l’état de tous les objets et les sauvegarde. Plus tard, lorsqu’un utilisateur décide d’annuler une action, l’application récupère la dernière sauvegarde de l’historique et s’en sert pour restaurer l’état de tous les objets.</p><img width=470 height=0 src=../../_resources/problem1-fr_fa7f3dd064484673adf792002729e3af.png><p>Avant d’effectuer une action, l’application prend un instantané (snapshot) du dernier état des objets. Il peut être utilisé plus tard pour rétablir les objets dans leur ancien état.</p><p>Prenons un moment pour réfléchir à ces photos. Comment va-t-on s’y prendre pour les créer ? Vous allez probablement devoir parcourir tous les attributs d’un objet et copier leurs valeurs quelque part. Cependant, cela ne fonctionnera que si le contenu de l’objet ne possède pas trop de restrictions. Malheureusement, la plupart des objets ne se laissent pas approcher si facilement et cachent les données importantes dans des attributs privés.</p><p>Laissons de côté ce problème pour le moment et considérons que nos objets se comportent en bons hippies : ils préfèrent avoir des relations ouvertes et garder leur état public. Même si cette approche nous permet de produire des instantanés de l’état des objets à volonté, de sérieux problèmes demeurent. Dans le futur, vous pourriez décider de refactoriser certaines classes de l’éditeur, ou d’ajouter ou de supprimer certains attributs. Cela semble facile à première vue, mais vous allez devoir également modifier les classes qui ont la responsabilité de créer la copie de l’état des objets concernés.</p><img width=300 height=0 src=../../_resources/problem2-fr_80975a310d0f4d7bb8a8ab114078b84f.png><p>Comment faire une copie de l’état privé d’un objet ?</p><p>Mais ce n’est pas tout ! Regardons un peu du côté des « photos » de l’état de l’éditeur. Quel genre de données contiennent-elles ? On doit au moins avoir accès aux coordonnées du curseur de la souris, à la position de la barre de défilement, etc. Pour prendre une photo, vous devez récupérer ces valeurs et les mettre dans un conteneur.</p><p>Vous allez très certainement stocker un paquet de ces conteneurs dans une liste qui représente l’historique. Ces conteneurs seront probablement les objets d’une classe. Cette classe possèdera très peu de méthodes, mais aura beaucoup d’attributs qui répliquent l’état de l’éditeur. Pour permettre à d’autres objets de lire et d’écrire les données d’une photo, vous allez devoir rendre ses attributs publics, ce qui exposerait les états de l’éditeur, qu’ils soient privés ou non. Les autres classes deviendraient dépendantes au moindre changement apporté à la classe photo. Si nous rendons ses attributs et méthodes privés, ces changements ne seraient de toute façon pas répercutés sur les autres classes.</p><p>Il semblerait que nous sommes dans une impasse : soit on expose tous les détails d’une classe, ce qui les rend trop fragiles, soit on restreint l’accès à leur état, ce qui empêche de prendre des instantanés. Dispose-t-on d’une autre technique pour implémenter un « annuler » ?</p><a href=#solution><h2 id=solution><span class=hanchor arialabel=Anchor># </span>Solution</h2></a><p>Tous les problèmes que nous rencontrons sont provoqués par une mauvaise encapsulation. Certains objets essayent d’en faire plus que ce qu’ils sont supposés faire. Pour récupérer les données dont ils ont besoin pour effectuer une action, ils envahissent l’espace personnel des autres objets, plutôt que de leur demander d’exécuter l’action eux-mêmes.</p><p>Le mémento délègue la création des états des photos à leur propriétaire, l’objet <em>créateur</em> (originator). Plutôt que d’essayer de copier l’état de l’éditeur depuis « l’extérieur », la classe de l’éditeur de texte peut prendre la photo elle-même, car elle a accès à son propre état.</p><p>Ce patron propose de stocker la copie de l’état de l’objet dans un objet spécial appelé <em>mémento</em>. Son contenu n’est accessible que pour l’objet qui l’a créé. Les autres objets peuvent communiquer avec les mémentos via une interface limitée qui leur permet de récupérer certaines métadonnées de la photo (date de création, nom de l’action effectuée, etc.), mais pas l’état de l’objet original contenu dans la photo.</p><img width=610 height=0 src=../../_resources/solution-fr_e5c079381dc546f4b3d5f0f7d4f60733.png><p>Le créateur a un accès total au mémento, alors que le gardien ne peut que consulter les métadonnées.</p><p>Une telle stratégie vous permet de stocker des mémentos à l’intérieur d’autres objets que l’on appelle <em>gardiens</em> (caretakers). Le gardien ne manipule le mémento qu’en passant par l’interface limitée. Il ne peut donc pas modifier les états qui y sont stockés. De son côté, le créateur rétablit les états qu’il désire, car il a accès à tous les attributs du mémento.</p><p>Dans l’exemple de notre éditeur de texte, nous pouvons créer une classe historique séparée qui prend le rôle du gardien. La pile de mémentos stockée dans le gardien va grandir chaque fois que l’éditeur va effectuer une action. Vous pouvez même afficher cette pile dans l’interface utilisateur, afin de montrer les dernières opérations effectuées par un utilisateur.</p><p>Lorsqu’un utilisateur veut annuler une action, l’historique prend le mémento le plus récent de la pile et l’envoie à l’éditeur en demandant un rollback. Comme l’éditeur possède un accès total au mémento, il change lui-même son état en copiant les valeurs du mémento.</p><a href=#structure><h2 id=structure><span class=hanchor arialabel=Anchor># </span>Structure</h2></a><a href=#implémentation-basée-sur-des-classes-imbriquées><h4 id=implémentation-basée-sur-des-classes-imbriquées><span class=hanchor arialabel=Anchor># </span>Implémentation basée sur des classes imbriquées</h4></a><p>L’implémentation classique du patron repose sur le principe des classes imbriquées, disponibles dans de nombreux langages de programmation populaires (comme le C++, C# et Java).</p><img width=580 height=0 src=../../_resources/structure1_34c2ae97af17429ebb3694f5c21bf5eb.png><ol><li><p>La classe <strong>Créateur</strong> (Originator) peut prendre des instantanés de son propre état, et le restaurer à volonté.</p></li><li><p>Le <strong>Mémento</strong> est un objet de valeur qui joue le rôle d’un instantané d’un état du créateur. En général, le mémento n’est pas modifiable et écrit ses données une seule fois dans son constructeur.</p></li><li><p>Le <strong>Gardien</strong> sait « quand » et « pourquoi » il doit photographier l’état du créateur, mais il sait également quand l’état doit être restauré.</p><p>Le gardien peut conserver la trace de l’historique du créateur en enregistrant une pile de mémentos. Lorsque le créateur veut revenir dans le passé, le gardien récupère l’élément du haut de la pile et l’envoie à la méthode de restauration du créateur.</p></li><li><p>Dans cette implémentation, la classe mémento est imbriquée à l’intérieur du créateur. Ceci permet au créateur d’accéder aux attributs et méthodes du mémento, même s’ils sont privés. Le gardien quant à lui n’a qu’un accès limité aux attributs et méthodes du mémento : on le laisse entasser les mémentos dans la pile, mais il ne peut pas les modifier.</p></li></ol><a href=#implémentation-basée-sur-une-interface-intermédiaire><h4 id=implémentation-basée-sur-une-interface-intermédiaire><span class=hanchor arialabel=Anchor># </span>Implémentation basée sur une interface intermédiaire</h4></a><p>Voici une autre possibilité très pratique pour les langages qui ne gèrent pas les classes imbriquées (oui PHP, je te regarde).</p><img width=560 height=0 src=../../_resources/structure2_f623ccee869148db8ac94dba7b451b89.png><ol><li><p>En l’absence de classes imbriquées, vous pouvez restreindre l’accès aux attributs du mémento en établissant une convention : les gardiens ne vont pouvoir manipuler un mémento qu’à travers une interface intermédiaire déclarée explicitement. Cette interface ne déclare que des méthodes liées aux métadonnées du mémento.</p></li><li><p>De leur côté, les créateurs peuvent manipuler directement les objets mémento, accéder à leurs attributs et méthodes déclarés dans la classe mémento. L’inconvénient de cette technique est que vous devez déclarer tous les membres du mémento en public.</p></li></ol><a href=#implémentation-avec-une-encapsulation-encore-plus-stricte><h4 id=implémentation-avec-une-encapsulation-encore-plus-stricte><span class=hanchor arialabel=Anchor># </span>Implémentation avec une encapsulation encore plus stricte</h4></a><p>Si vous ne voulez vraiment pas que les autres classes accèdent au créateur en passant par le mémento, vous pouvez vous y prendre différemment.</p><img width=590 height=0 src=../../_resources/structure3_82aecfba5f5b4323bafec0affac38f07.png><ol><li><p>Cette implémentation permet de gérer plusieurs créateurs et plusieurs mémentos. Chaque créateur manipule sa propre classe mémento. Les créateurs et les mémentos n’exposent pas leur état aux autres.</p></li><li><p>Il est désormais explicité que les gardiens ne peuvent pas modifier l’état stocké dans le mémento. De plus, la classe gardien n’est plus couplée avec le créateur, car la méthode de restauration est maintenant définie dans la classe mémento.</p></li><li><p>Chaque mémento devient lié au créateur qui l’a produite. Le créateur s’envoie lui-même et toutes les valeurs de son état au constructeur du mémento. Grâce à l’étroite proximité de ces deux classes, un mémento peut restaurer l’état de son créateur, tant que ce dernier a bien défini les setters appropriés.</p></li></ol><a href=#pseudo-code><h2 id=pseudo-code><span class=hanchor arialabel=Anchor># </span>Pseudo-code</h2></a><p>Cet exemple utilise le patron
<a href=https://refactoring.guru/fr/design-patterns/command rel=noopener>Commande</a> en plus du mémento pour stocker les photos de l’état de l’éditeur de texte complexe, et rétablit un état précédent lorsqu’on le lui demande.</p><img width=600 height=0 src=../../_resources/example_5e4ab6e60ec64528baac79ac3f05dd8b.png><p>Sauvegarder des photos de l’état de l’éditeur de texte.</p><p>Les objets commande prennent le rôle de gardiens. Ils vont chercher le mémento de l’éditeur avant de lancer les actions déclenchées par les commandes. Lorsqu’un utilisateur veut annuler l’action la plus récente, l’éditeur peut se servir du mémento stocké dans cette commande pour revenir à son état précédent.</p><p>La classe mémento ne déclare aucun attribut public, ni de getters et de setters. Aucun objet ne peut modifier son contenu. Les mémentos sont reliés à l’objet éditeur qui les a créés. Le mémento peut aussi restaurer l’état de l’éditeur qui lui est associé, en passant les données dans les setters de l’objet éditeur. Comme les mémentos sont liés à des objets éditeur spécifiques, votre application peut gérer plusieurs fenêtres avec des éditeurs indépendants et une pile centralisée d’états à rétablir.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>// Le créateur conserve des données importantes qui varient
</span></span><span class=line><span class=cl>// parfois avec le temps. Il définit également une méthode pour
</span></span><span class=line><span class=cl>// sauvegarder son état dans un mémento, et une autre méthode
</span></span><span class=line><span class=cl>// pour rétablir cet état.
</span></span><span class=line><span class=cl>class Editor is
</span></span><span class=line><span class=cl>    private field text, curX, curY, selectionWidth
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method setText(text) is
</span></span><span class=line><span class=cl>        this.text = text
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method setCursor(x, y) is
</span></span><span class=line><span class=cl>        this.curX = x
</span></span><span class=line><span class=cl>        this.curY = y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method setSelectionWidth(width) is
</span></span><span class=line><span class=cl>        this.selectionWidth = width
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Sauvegarde l’état actuel dans un mémento.
</span></span><span class=line><span class=cl>    method createSnapshot():Snapshot is
</span></span><span class=line><span class=cl>        // Le mémento est un objet non modifiable. C’est pour
</span></span><span class=line><span class=cl>        // cela que le créateur passe son état dans les
</span></span><span class=line><span class=cl>        // paramètres du constructeur du mémento.
</span></span><span class=line><span class=cl>        return new Snapshot(this, text, curX, curY, selectionWidth)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// La classe mémento conserve un ancien état de l’éditeur.
</span></span><span class=line><span class=cl>class Snapshot is
</span></span><span class=line><span class=cl>    private field editor: Editor
</span></span><span class=line><span class=cl>    private field text, curX, curY, selectionWidth
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    constructor Snapshot(editor, text, curX, curY, selectionWidth) is
</span></span><span class=line><span class=cl>        this.editor = editor
</span></span><span class=line><span class=cl>        this.text = text
</span></span><span class=line><span class=cl>        this.curX = x
</span></span><span class=line><span class=cl>        this.curY = y
</span></span><span class=line><span class=cl>        this.selectionWidth = selectionWidth
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    // Un objet mémento peut être utilisé pour rétablir un
</span></span><span class=line><span class=cl>    // ancien état de l’éditeur.
</span></span><span class=line><span class=cl>    method restore() is
</span></span><span class=line><span class=cl>        editor.setText(text)
</span></span><span class=line><span class=cl>        editor.setCursor(curX, curY)
</span></span><span class=line><span class=cl>        editor.setSelectionWidth(selectionWidth)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Un objet commande peut prendre le rôle du gardien. Dans ce
</span></span><span class=line><span class=cl>// cas, un mémento est affecté à la commande juste avant que
</span></span><span class=line><span class=cl>// l&#39;état du créateur ne change. Lorsqu’une demande de
</span></span><span class=line><span class=cl>// restauration arrive, il rétablit l’état du créateur à partir
</span></span><span class=line><span class=cl>// du mémento.
</span></span><span class=line><span class=cl>class Command is
</span></span><span class=line><span class=cl>    private field backup: Snapshot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method makeBackup() is
</span></span><span class=line><span class=cl>        backup = editor.createSnapshot()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    method undo() is
</span></span><span class=line><span class=cl>        if (backup != null)
</span></span><span class=line><span class=cl>            backup.restore()
</span></span><span class=line><span class=cl>    // ...
</span></span></code></pre></td></tr></table></div></div><a href=#possibilités-dapplication><h2 id=possibilités-dapplication><span class=hanchor arialabel=Anchor># </span>Possibilités d’application</h2></a><p>Utilisez le mémento si vous voulez prendre des photos de l’état d’un objet afin de pouvoir rétablir un de ses états précédents.</p><p>Le mémento vous permet de faire des copies complètes de l’état d’un objet (attributs privés inclus), et les stocke en dehors de l’objet. Ce patron est surtout connu pour l’utilisation de la fonctionnalité annuler, mais est également indispensable pour les transactions (par exemple, pour permettre le rollback d’une opération en erreur).</p><p>Utilisez ce patron lorsque vous ne pouvez pas accéder directement aux attributs/getters/setters d’un objet sans enfreindre les principes de l’encapsulation.</p><p>Le mémento rend l’objet responsable de lui-même, ce qui sécurise les données de l’état de l’objet. Aucun autre objet ne peut lire les données de la photo, l’objet original est donc complètement sécurisé.</p><a href=#mise-en-œuvre><h2 id=mise-en-œuvre><span class=hanchor arialabel=Anchor># </span>Mise en œuvre</h2></a><ol><li><p>Déterminez la classe qui jouera le rôle du créateur. Il est important de savoir si le programme va utiliser un seul objet central ou plusieurs petits objets.</p></li><li><p>Créez la classe mémento. Déclarez un à un l’ensemble des attributs qui recopient les attributs de la classe créateur.</p></li><li><p>Rendez la classe mémento non modifiable. Un mémento ne doit écrire ses données qu’une seule fois via son constructeur. Sa classe ne doit pas avoir de setters.</p></li><li><p>Si votre langage de programmation accepte les classes imbriquées, mettez le mémento à l’intérieur du créateur. Sinon, extrayez une interface vide depuis la classe du mémento et obligez les autres objets à utiliser cette interface pour y accéder. Vous pouvez ajouter des opérations sur les métadonnées dans l’interface, mais rien qui ne puisse exposer l’état du créateur.</p></li><li><p>Ajoutez une méthode qui crée des mémentos à la classe créateur. Le créateur doit passer son état dans un ou plusieurs paramètres du constructeur du mémento.</p><p>Le type de la valeur de retour de la méthode doit être l’interface extraite dans l’étape précédente (si vous avez suivi cette étape). La méthode qui crée le mémento doit directement manipuler la classe mémento.</p></li><li><p>Écrivez la méthode qui permet de rétablir l’état du créateur dans sa propre classe. Il doit prendre un objet mémento en paramètre. Si vous avez extrait une interface lors de l’une des étapes précédentes, c’est le type de la valeur de retour que cette méthode doit accepter. Dans ce cas, vous devez caster cet objet dans la classe mémento, car le créateur a besoin d’un accès total à cet objet.</p></li><li><p>Le gardien, que ce soit une commande, un historique ou n’importe quoi d’autre, doit savoir quand demander de nouveaux mémentos au créateur, comment les stocker et quand restaurer le créateur à l’aide d’un mémento donné.</p></li><li><p>Le lien entre les gardiens et les créateurs peut être déplacé dans la classe mémento. Dans ce cas, chaque mémento doit être associé à son propre créateur. La méthode de restauration doit également être déplacée dans la classe mémento. Mais faites-le uniquement si la classe mémento est imbriquée dans son créateur, ou si la classe du créateur fournit assez de setters pour redéfinir son état.</p></li></ol><a href=#avantages-et-inconvénients><h2 id=avantages-et-inconvénients><span class=hanchor arialabel=Anchor># </span>Avantages et inconvénients</h2></a><ul><li><p>Vous pouvez prendre des instantanés de l’état d’un objet tout en respectant son encapsulation.</p></li><li><p>Vous pouvez simplifier le code du créateur en laissant le gardien gérer l’historique de l’état du créateur.</p></li><li><p>L’application pourrait consommer beaucoup de RAM si les clients créent des mémentos trop souvent.</p></li><li><p>Les gardiens doivent garder la trace du cycle de vie des créateurs pour pouvoir détruire les mémentos obsolètes.</p></li><li><p>La majorité des langages de programmation dynamiques comme le PHP, Python ou le JavaScript ne peuvent pas garantir que l’état sauvegardé dans le mémento ne sera pas modifié.</p></li></ul><a href=#liens-avec-les-autres-patrons><h2 id=liens-avec-les-autres-patrons><span class=hanchor arialabel=Anchor># </span>Liens avec les autres patrons</h2></a><ul><li><p>Vous pouvez utiliser la
<a href=https://refactoring.guru/fr/design-patterns/command rel=noopener>Commande</a> et le
<a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Mémento</a> ensemble pour implémenter la fonctionnalité « annuler ». Dans ce cas, les commandes ont la responsabilité d’exécuter les divers traitements sur un objet cible. Les mémentos sauvegardent l’état de cet objet juste avant le lancement de la commande.</p></li><li><p>Vous pouvez utiliser le
<a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Mémento</a> avec l’
<a href=https://refactoring.guru/fr/design-patterns/iterator rel=noopener>Itérateur</a> pour récupérer l’état actuel de l’itération et rétablir sa valeur plus tard si besoin.</p></li><li><p>Parfois le
<a href=https://refactoring.guru/fr/design-patterns/prototype rel=noopener>Prototype</a> peut venir remplacer le
<a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Mémento</a> et proposer une solution plus simple. Cela n’est possible que si l’objet (l’état que vous voulez stocker dans l’historique) est assez direct et ne possède pas de liens vers des ressources externes, ou que les liens sont faciles à recréer.</p></li></ul><a href=#exemples-de-code><h2 id=exemples-de-code><span class=hanchor arialabel=Anchor># </span>Exemples de code</h2></a><p><a href=https://refactoring.guru/fr/design-patterns/memento/java/example rel=noopener><img width=43 height=56 src=../../_resources/java_bb24a0ec83eb45659ad0ca626065e81a.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/csharp/example rel=noopener><img width=43 height=56 src=../../_resources/csharp_acaaf63c1dc342faaaca6a691718109d.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/cpp/example rel=noopener><img width=43 height=56 src=../../_resources/cpp_dbe89c1423f94fc18dfa833ff90c966d.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/php/example rel=noopener><img width=43 height=56 src=../../_resources/php_36f9f74901434ccfad22ee18aaa66e6c.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/python/example rel=noopener><img width=43 height=56 src=../../_resources/python_d4f6bc1d3e7948f589cec749d357e508.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/ruby/example rel=noopener><img width=43 height=56 src=../../_resources/ruby_c9324f1b778841b3850b5c5f3fa1fd1a.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/swift/example rel=noopener><img width=43 height=56 src=../../_resources/swift_f71621aeb3f442ad90fa8e259d0d8082.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/typescript/example rel=noopener><img width=43 height=56 src=../../_resources/typescript_354a1917fe32401b8c3f7614927b900e.svg></a>
<a href=https://refactoring.guru/fr/design-patterns/memento/go/example rel=noopener><img width=43 height=56 src=../../_resources/go_5e5cce54e2034d98909afff545fadb29.svg></a></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener><img width=200 height=200 src=../../_resources/patterns-book-banner-3_89ed79455d9440fd824034deb5f.png></a></p><a href=#soutenez-notre-site-gratuit-et-obtenez-lebook><h3 id=soutenez-notre-site-gratuit-et-obtenez-lebook><span class=hanchor arialabel=Anchor># </span>Soutenez notre site gratuit et obtenez l’ebook !</h3></a><ul><li>22 patrons de conception et 8 principes expliqués en profondeur.</li><li>444 pages de vulgarisation, bien structurées et faciles à lire.</li><li>225 illustrations et diagrammes clairs pour aider à la compréhension.</li><li>Une archive avec des exemples de code dans 9 langages.</li><li>Tous les appareils sont pris en charge : formats PDF/EPUB/MOBI/KFX.</li></ul><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener>En savoir plus…</a></p><a href=#suivant><h4 id=suivant><span class=hanchor arialabel=Anchor># </span>Suivant</h4></a><p><a href=https://refactoring.guru/fr/design-patterns/observer rel=noopener>Observateur</a></p><a href=#retour><h4 id=retour><span class=hanchor arialabel=Anchor># </span>Retour</h4></a><p><a href=https://refactoring.guru/fr/design-patterns/mediator rel=noopener>Médiateur</a></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener><img width=245 height=375 src=../../_resources/web-cover-fr_182eb7a47d2a4b7f8e875095be2a48df.png></a></p><p>Cet article est tiré de notre ebook
<strong>Plongée au cœur des
PATRONS DE CONCEPTION</strong></p><p><a href=https://refactoring.guru/fr/design-patterns/book rel=noopener>En savoir plus…</a></p><p>Facebook</p><p>Twitter</p><ul><li><a href="https://feedback.refactoring.guru/?lang=en&show_feedback_form_private=true" rel=noopener>Nous contacter</a></li><li><a href=https://refactoring.guru/fr/login rel=noopener>Connexion</a></li></ul><p><a href=https://refactoring.guru/design-patterns/memento rel=noopener>English</a>
<a href=https://refactoring.guru/es/design-patterns/memento rel=noopener>Español</a>
<a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Français</a>
<a href=https://refactoring.guru/pl/design-patterns/memento rel=noopener>Polski</a>
<a href=https://refactoring.guru/pt-br/design-patterns/memento rel=noopener>Português-Br</a>
<a href=https://refactoring.guru/ru/design-patterns/memento rel=noopener>Русский</a>
<a href=https://refactoring.guru/uk/design-patterns/memento rel=noopener>Українська</a>
<a href=https://refactoringguru.cn/design-patterns/memento rel=noopener>中文</a></p><p><a href=https://refactoring.guru/fr rel=noopener><img src=https://deuxfois.github.io/quartz//../../_resources/logo-covid-winter_233a9b0746fa4eb5aa4fe979ce2218a7.png width=auto alt=Refactoring.Guru></a></p><p><img src=https://deuxfois.github.io/quartz//../../_resources/winter-hat_7110bf5a5ba24131870dc90154a62986.png width=auto alt></p><ul><li><a href=https://refactoring.guru/fr/store rel=noopener>Contenu premium</a></li><li><a href=https://refactoring.guru/fr/design-patterns rel=noopener>Patrons de conception</a><ul><li><a href=https://refactoring.guru/fr/design-patterns/what-is-pattern rel=noopener>Introduction</a></li><li><a href=https://refactoring.guru/fr/design-patterns/catalog rel=noopener>Catalogue</a></li><li><a href=https://refactoring.guru/fr/design-patterns/creational-patterns rel=noopener>Patrons de création</a></li><li><a href=https://refactoring.guru/fr/design-patterns/structural-patterns rel=noopener>Patrons structurels</a></li><li><a href=https://refactoring.guru/fr/design-patterns/behavioral-patterns rel=noopener>Patrons comportementaux</a><ul><li><a href=https://refactoring.guru/fr/design-patterns/chain-of-responsibility rel=noopener>Chaîne de responsabilité</a></li><li><a href=https://refactoring.guru/fr/design-patterns/command rel=noopener>Commande</a></li><li><a href=https://refactoring.guru/fr/design-patterns/iterator rel=noopener>Itérateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/mediator rel=noopener>Médiateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/memento rel=noopener>Mémento</a></li><li><a href=https://refactoring.guru/fr/design-patterns/observer rel=noopener>Observateur</a></li><li><a href=https://refactoring.guru/fr/design-patterns/state rel=noopener>État</a></li><li><a href=https://refactoring.guru/fr/design-patterns/strategy rel=noopener>Stratégie</a></li><li><a href=https://refactoring.guru/fr/design-patterns/template-method rel=noopener>Patron de méthode</a></li><li><a href=https://refactoring.guru/fr/design-patterns/visitor rel=noopener>Visiteur</a></li></ul></li><li><a href=https://refactoring.guru/fr/design-patterns/examples rel=noopener>Exemples de code</a></li></ul></li><li><a href=https://refactoring.guru/fr/refactoring rel=noopener>Refactorisation (commenter bientôt)</a></li></ul><p><a href=https://refactoring.guru/fr/login rel=noopener>Connexion</a>
<a href="https://feedback.refactoring.guru/?lang=en" rel=noopener>Nous contacter</a></p><ul><li><a href=https://refactoring.guru/fr rel=noopener>Accueil</a></li><li><a href=https://refactoring.guru/fr/refactoring rel=noopener>Refactorisation</a></li><li><a href=https://refactoring.guru/fr/design-patterns rel=noopener>Patrons de conception</a></li><li><a href=https://refactoring.guru/fr/store rel=noopener>Contenu premium</a></li><li><a href="https://feedback.refactoring.guru/?lang=en" rel=noopener>Forum</a></li><li><a href="https://feedback.refactoring.guru/?lang=en&show_feedback_form_private=true" rel=noopener>Nous contacter</a></li></ul><p>2014-2021
<a href=https://refactoring.guru/fr rel=noopener>Refactoring.Guru</a>. Tous droits réservés.
<img src=https://deuxfois.github.io/quartz//../../_resources/fa-building_92749a2b41304699a390922775e15f9e.svg width=auto alt="Organization address"> Khmelnitske shosse 19 / 27, Kamianets-Podilskyi, Ukraine, 32305
Email:
<a rel=noopener class="internal-link broken" data-src=mailto:support@refactoring.guru>support@refactoring.guru</a></p><p>Illustrations par
<a href=http://zhart.us/ rel=noopener>Dmitry Zhart</a></p><ul><li><a href=https://refactoring.guru/fr/terms rel=noopener>Termes et conditions</a></li><li><a href=https://refactoring.guru/fr/privacy-policy rel=noopener>Politique de protection de la vie privée</a></li><li><a href=https://refactoring.guru/fr/content-usage-policy rel=noopener>Politique de l’utilisation des données</a></li></ul></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://deuxfois.github.io/quartz/js/graph.243ea0d4fc79317e06f846bd698ba136.js></script></div></div><div id=contact_buttons><footer><p>Made by DeuxFois using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://deuxfois.github.io/quartz/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div></div></body></html>