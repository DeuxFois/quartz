<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Simplest Galaxy renderer INF2110 - Introduction à l’Informatique Graphique
**Philippe Kévin**kv.philippe@gmail.comUniversité Bretagne Sud   Usage compile make -f Makefile outputName"><title>Simplest Galaxy renderer</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://deuxfois.github.io/quartz//icon.png><link href=https://deuxfois.github.io/quartz/styles.b54f56dc7e7fdf6be9a4427dc6b0509b.min.css rel=stylesheet><link href=https://deuxfois.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://deuxfois.github.io/quartz/js/darkmode.69b2c08ae0f08c3a3f86259a122e1f06.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/util.39f53d45cb9520bdaf946bd063598b19.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://deuxfois.github.io/quartz/js/popover.37b1455b8f0603154072b9467132c659.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://deuxfois.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://deuxfois.github.io/quartz/",fetchData=Promise.all([fetch("https://deuxfois.github.io/quartz/indices/linkIndex.668a7938cf11b7eb01cc194bddc133e0.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://deuxfois.github.io/quartz/indices/contentIndex.396a82180f6e9cf02145bda53551401c.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const n=new URL(BASE_URL),s=n.pathname,o=window.location.pathname,i=s==o;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts();const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=i&&!0;drawGraph("https://deuxfois.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:2,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2}),initPopover("https://deuxfois.github.io/quartz",!0,!0)},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/deuxfois.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://deuxfois.github.io/quartz/js/full-text-search.0ec5fb908204b9e13989f2c640c0870b.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://deuxfois.github.io/quartz/>⛄ DeuxFoi's blog</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Simplest Galaxy renderer</h1><p class=meta>Last updated
Aug 2, 2022
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/Master/Graphisme/Simplest%20Galaxy%20renderer.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://deuxfois.github.io/quartz/tags/graphisme/>Graphisme</a></li><li><a href=https://deuxfois.github.io/quartz/tags/s1/>S1</a></li></ul><aside class=mainTOC><details open><summary>Table of Contents</summary><nav id=TableOfContents></nav></details></aside><a href=#simplest-galaxy-renderer><h1 id=simplest-galaxy-renderer><span class=hanchor arialabel=Anchor># </span>Simplest Galaxy renderer</h1></a><p>INF2110 - Introduction à l’Informatique Graphique</p><center>**Philippe Kévin**</center><center>kv.philippe@gmail.com</center><center>Université Bretagne Sud</center><center><p><img src=https://deuxfois.github.io/quartz//../../../_resources/13239632316fdb58bfc0175f4a45b215.png width=auto alt=13239632316fdb58bfc0175f4a45b215.png></p></center><a href=#usage><h1 id=usage><span class=hanchor arialabel=Anchor># </span>Usage</h1></a><p><strong>compile</strong> <code>make -f Makefile outputName</code></p><p><strong>run</strong> <code>./outputName</code></p><a href=#résumé><h1 id=résumé><span class=hanchor arialabel=Anchor># </span>Résumé</h1></a><p>Ce mini projet en introduction à l’informatique graphique, est inspiré de l’article de Beltoforion
<a href=https://beltoforion.de/en/spiral_galaxy_renderer/ rel=noopener>Rendering a Galaxy with the density wave theory</a> avec une implémentation simplifié, ne prenant pas en compte la théorie de la densité, ni les lois de Kepler.</p><p>Le projet c’est établi suivant 3 étapes :</p><ul><li>Trajectoire et initialisation des étoiles</li><li>Luminosité</li><li>Couleur</li></ul><p>Mots clé : QGLViewer, Midpoint Algorithm, glsl Shaders</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── include
</span></span><span class=line><span class=cl>│   ├── Galaxy.h
</span></span><span class=line><span class=cl>│   ├── Shader.h
</span></span><span class=line><span class=cl>│   ├── specrend.h
</span></span><span class=line><span class=cl>│   ├── utils.h
</span></span><span class=line><span class=cl>│   └── Viewer.h
</span></span><span class=line><span class=cl>├── main.cpp
</span></span><span class=line><span class=cl>├── Makefile
</span></span><span class=line><span class=cl>├── shader.frag
</span></span><span class=line><span class=cl>├── shader.vert
</span></span><span class=line><span class=cl>├── src
</span></span><span class=line><span class=cl>│   ├── Galaxy.cpp
</span></span><span class=line><span class=cl>│   ├── Shader.cpp
</span></span><span class=line><span class=cl>│   ├── utils.cpp
</span></span><span class=line><span class=cl>│   └── Viewer.cpp
</span></span><span class=line><span class=cl>├── tp8.pro
</span></span><span class=line><span class=cl>└──  tp8.pro.user
</span></span></code></pre></td></tr></table></div></div><a href=#1-trajectoire-et-initialisation-des-étoiles><h1 id=1-trajectoire-et-initialisation-des-étoiles><span class=hanchor arialabel=Anchor># </span>1 Trajectoire et initialisation des étoiles</h1></a><p>La création des étoiles est assez bancale et mériterait de suivre une loi normale ou une strategie plus effective pour pouvoir être généralisé. Elle donne cependant un bon résultat pour les données prédéfinit, en lancant le programme sans arguments.</p><p>Pour simplifier le problème, nous supposons que la trajectoire des étoiles suivent des ellipses qui se décalent petit à petit. Il s’agit donc de créer des étoiles suivant ces ellipses avec une répartition réaliste, pour que l’univers soit plus dense au centre.</p><p>Pour cela j’ai commencé par dessiner le centre de la galaxy avec le MidPoint circle algorithm et les ellipses autour. J’ai ensuite intialisé le nombre moyen d’étoiles par éllipse, accompagné d’un ratio suivant la distance au centre, et un vecteur de décalage aléatoire sur x et y pour que ce soit plus réaliste. La vitesse est calculé par soustraction entre le prochain point sur l’ellipse, le plus proche, et la position du point sur l’ellipse sans son vecteur de décalage.</p><center><img src=../../../_resources/e433a94be8373f061947a7bcb8692e2a.png alt=e433a94be8373f061947a7bcb8692e2a.png width=369 height=423 class=jop-noMdConv><img src=../../../_resources/92a7e28faace39af6bed91197a66eb06.png alt=92a7e28faace39af6bed91197a66eb06.png width=444 height=423 class=jop-noMdConv></center>
<a href=#2-luminosité><h1 id=2-luminosité><span class=hanchor arialabel=Anchor># </span>2 Luminosité</h1></a><p>L’article stipule que conformément à Freeman, K. C.,
<a href=http://adsabs.harvard.edu/cgi-bin/bib_query%3F1970ApJ...160..811F rel=noopener><em>“On the Disks of Spiral and so Galaxies”</em></a> (1970). Astrophysical Journal, vol. 160, p.811   La luminosité peut être décrite suivant une loi exponentiel :</p><p><img src=https://deuxfois.github.io/quartz//../../../_resources/be5eff996f644fc9355b3bcba68e0fc8.png width=auto alt=be5eff996f644fc9355b3bcba68e0fc8.png> avec I<sub>0</sub> l’intensité centrale, R la distance au centre et Rd une distance à laquelle l’intensité descend de 50%</p><p>J’ai décidé d’utiliser le fragment shader avec comme variables uniform, la position de l’étoile dans la galaxy  on a donc :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>uniform</span> <span class=kt>float</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>uniform</span> <span class=kt>float</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>uniform</span> <span class=kt>float</span> <span class=n>z</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>   
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>dx</span> <span class=o>=</span> <span class=n>abs</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>dy</span> <span class=o>=</span> <span class=n>abs</span><span class=p>(</span><span class=n>y</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>dist</span> <span class=o>=</span> <span class=n>sqrt</span><span class=p>(</span><span class=n>dx</span><span class=o>*</span><span class=n>dx</span> <span class=o>+</span> <span class=n>dy</span><span class=o>*</span><span class=n>dy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>lumOfCenter</span> <span class=o>=</span> <span class=mf>10.0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>float</span> <span class=n>l</span> <span class=o>=</span> <span class=n>lumOfCenter</span> <span class=o>*</span> <span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>dist</span><span class=o>/</span><span class=mf>10.0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>l</span> <span class=o>&lt;</span> <span class=mf>0.3</span><span class=p>)</span> <span class=n>l</span> <span class=o>=</span> <span class=mf>0.3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>vec4</span> <span class=n>col</span> <span class=o>=</span> <span class=n>vec4</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=mf>1.0</span><span class=p>,</span><span class=mf>1.0</span><span class=p>,</span><span class=n>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>gl_FragColor</span><span class=o>=</span><span class=n>col</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>L’utilisation d’un vecteur en variable uniform serait preferable</p><center><img src=../../../_resources/44a6dcfa9958e89aa051eab4471ba4ff.png alt=44a6dcfa9958e89aa051eab4471ba4ff.png width=328 height=355 class=jop-noMdConv><img src=../../../_resources/dcc69acde1822fa0d982d9da8958950c.png alt=dcc69acde1822fa0d982d9da8958950c.png width=603 height=356 class=jop-noMdConv></center>
<a href=#3-couleurs><h1 id=3-couleurs><span class=hanchor arialabel=Anchor># </span>3 Couleurs</h1></a><p>D’après la loi de Planck, la température de surface des étoiles dans la galaxie simulée se situe entre 3000 et 9000 Kelvin. En réalité, la température de surface d’une étoile est sujette à des changements tout au long de sa vie, au fur et à mesure qu’elle progresse dans sa trajectoire dans le diagramme de Hertzsprung Russell.</p><p>L’article cite alors,  d’un programme de John Walker appelé
<a href=https://www.fourmilab.ch/documents/specrend/specrend.c rel=noopener>specrend.c</a> (1996, April 25). Publié dans le domaine publique et qui peut calculer les valeurs RGB pour une température donnée. Il explique l’algorithmie sur son site :  
<a href=http://www.fourmilab.ch/documents/specrend/ rel=noopener>“Colour Rendering of Spectra.”</a> J’utilise alors son programme pour calculer la couleurs des étoiles et les donner au fragment shader</p><a href=#conclusion><h1 id=conclusion><span class=hanchor arialabel=Anchor># </span>Conclusion</h1></a><center><p><img src=https://deuxfois.github.io/quartz//../../../_resources/fe5f5ee4ae5280236728bc010593f73a.png width=auto alt=fe5f5ee4ae5280236728bc010593f73a.png><img src=../../../_resources/54478e8aff9e5a113edc436c7a67fb70.png alt=54478e8aff9e5a113edc436c7a67fb70.png width=328 height=291 class=jop-noMdConv></p></center>Le résultat est très différent de la réalité, les simplifications sont, sans doute, trop nombreuses. Il faudrait implémenter une sorte de blur et de fumée. Mais il reste agréable à regarder<p>Des améliorations peuvent naturellement être apporté comme énoncé ci dessus, ou revoir l’initialisation et la vitesse des étoiles, créer différents types d’étoiles et vérifier les performances et fuite de mémoire.</p></article><hr><div class=page-end><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://deuxfois.github.io/quartz/js/graph.243ea0d4fc79317e06f846bd698ba136.js></script></div></div><div id=contact_buttons><footer><p>Made by DeuxFois using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://deuxfois.github.io/quartz/>Home</a></li><li><a href=https://twitter.com/_jzhao>Twitter</a></li><li><a href=https://github.com/jackyzha0>Github</a></li></ul></footer></div></div></body></html>